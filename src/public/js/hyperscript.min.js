var __create = Object.create;
var __getProtoOf = Object.getPrototypeOf;
var __defProp = Object.defineProperty;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __toESM = (mod, isNodeMode, target) => {
  target = mod != null ? __create(__getProtoOf(mod)) : {};
  const to = isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target;
  for (let key of __getOwnPropNames(mod))
    if (!__hasOwnProp.call(to, key))
      __defProp(to, key, {
        get: () => mod[key],
        enumerable: true
      });
  return to;
};
var __commonJS = (cb, mod) => () => (mod || cb((mod = { exports: {} }).exports, mod), mod.exports);

// node_modules/hyperscript.org/dist/_hyperscript.min.js
var require__hyperscript_min = __commonJS((exports, module) => {
  (function(e, t) {
    const r = t(e);
    if (typeof exports === "object" && typeof exports.nodeName !== "string") {
      module.exports = r;
    } else {
      e["_hyperscript"] = r;
      if ("document" in e)
        e["_hyperscript"].browserInit();
    }
  })(typeof self !== "undefined" ? self : exports, (e) => {
    const t = { dynamicResolvers: [function(e2, t2) {
      if (e2 === "Fixed") {
        return Number(t2).toFixed();
      } else if (e2.indexOf("Fixed:") === 0) {
        let r2 = e2.split(":")[1];
        return Number(t2).toFixed(parseInt(r2));
      }
    }], String: function(e2) {
      if (e2.toString) {
        return e2.toString();
      } else {
        return "" + e2;
      }
    }, Int: function(e2) {
      return parseInt(e2);
    }, Float: function(e2) {
      return parseFloat(e2);
    }, Number: function(e2) {
      return Number(e2);
    }, Date: function(e2) {
      return new Date(e2);
    }, Array: function(e2) {
      return Array.from(e2);
    }, JSON: function(e2) {
      return JSON.stringify(e2);
    }, Object: function(e2) {
      if (e2 instanceof String) {
        e2 = e2.toString();
      }
      if (typeof e2 === "string") {
        return JSON.parse(e2);
      } else {
        return Object.assign({}, e2);
      }
    } };
    const r = { attributes: "_, script, data-script", defaultTransition: "all 500ms ease-in", disableSelector: "[disable-scripting], [data-disable-scripting]", hideShowStrategies: {}, conversions: t };

    class n {
      static OP_TABLE = { "+": "PLUS", "-": "MINUS", "*": "MULTIPLY", "/": "DIVIDE", ".": "PERIOD", "..": "ELLIPSIS", "\\": "BACKSLASH", ":": "COLON", "%": "PERCENT", "|": "PIPE", "!": "EXCLAMATION", "?": "QUESTION", "#": "POUND", "&": "AMPERSAND", $: "DOLLAR", ";": "SEMI", ",": "COMMA", "(": "L_PAREN", ")": "R_PAREN", "<": "L_ANG", ">": "R_ANG", "<=": "LTE_ANG", ">=": "GTE_ANG", "==": "EQ", "===": "EQQ", "!=": "NEQ", "!==": "NEQQ", "{": "L_BRACE", "}": "R_BRACE", "[": "L_BRACKET", "]": "R_BRACKET", "=": "EQUALS", "~": "TILDE" };
      static isValidCSSClassChar(e2) {
        return n.isAlpha(e2) || n.isNumeric(e2) || e2 === "-" || e2 === "_" || e2 === ":";
      }
      static isValidCSSIDChar(e2) {
        return n.isAlpha(e2) || n.isNumeric(e2) || e2 === "-" || e2 === "_" || e2 === ":";
      }
      static isWhitespace(e2) {
        return e2 === " " || e2 === "\t" || n.isNewline(e2);
      }
      static positionString(e2) {
        return "[Line: " + e2.line + ", Column: " + e2.column + "]";
      }
      static isNewline(e2) {
        return e2 === "\r" || e2 === `
`;
      }
      static isNumeric(e2) {
        return e2 >= "0" && e2 <= "9";
      }
      static isAlpha(e2) {
        return e2 >= "a" && e2 <= "z" || e2 >= "A" && e2 <= "Z";
      }
      static isIdentifierChar(e2, t2) {
        return e2 === "_" || e2 === "$";
      }
      static isReservedChar(e2) {
        return e2 === "`" || e2 === "^";
      }
      static isValidSingleQuoteStringStart(e2) {
        if (e2.length > 0) {
          var t2 = e2[e2.length - 1];
          if (t2.type === "IDENTIFIER" || t2.type === "CLASS_REF" || t2.type === "ID_REF") {
            return false;
          }
          if (t2.op && (t2.value === ">" || t2.value === ")")) {
            return false;
          }
        }
        return true;
      }
      static tokenize(e2, t2) {
        var r2 = [];
        var a2 = e2;
        var o2 = 0;
        var s2 = 0;
        var u2 = 1;
        var l2 = "<START>";
        var c2 = 0;
        function f2() {
          return t2 && c2 === 0;
        }
        while (o2 < a2.length) {
          if (q() === "-" && I() === "-" && (n.isWhitespace(C(2)) || C(2) === "" || C(2) === "-") || q() === "/" && I() === "/" && (n.isWhitespace(C(2)) || C(2) === "" || C(2) === "/")) {
            h2();
          } else if (q() === "/" && I() === "*" && (n.isWhitespace(C(2)) || C(2) === "" || C(2) === "*")) {
            v2();
          } else {
            if (n.isWhitespace(q())) {
              r2.push(L());
            } else if (!A() && q() === "." && (n.isAlpha(I()) || I() === "{" || I() === "-")) {
              r2.push(d2());
            } else if (!A() && q() === "#" && (n.isAlpha(I()) || I() === "{")) {
              r2.push(k2());
            } else if (q() === "[" && I() === "@") {
              r2.push(E2());
            } else if (q() === "@") {
              r2.push(T2());
            } else if (q() === "*" && n.isAlpha(I())) {
              r2.push(y2());
            } else if (f2() && (n.isAlpha(q()) || q() === "\\")) {
              r2.push(x2());
            } else if (!f2() && (n.isAlpha(q()) || n.isIdentifierChar(q()))) {
              r2.push(g2());
            } else if (n.isNumeric(q())) {
              r2.push(b2());
            } else if (!f2() && (q() === '"' || q() === "`")) {
              r2.push(S2());
            } else if (!f2() && q() === "'") {
              if (n.isValidSingleQuoteStringStart(r2)) {
                r2.push(S2());
              } else {
                r2.push(w2());
              }
            } else if (n.OP_TABLE[q()]) {
              if (l2 === "$" && q() === "{") {
                c2++;
              }
              if (q() === "}") {
                c2--;
              }
              r2.push(w2());
            } else if (f2() || n.isReservedChar(q())) {
              r2.push(p2("RESERVED", R()));
            } else {
              if (o2 < a2.length) {
                throw Error("Unknown token: " + q() + " ");
              }
            }
          }
        }
        return new i(r2, [], a2);
        function m2(e3, t3) {
          var r3 = p2(e3, t3);
          r3.op = true;
          return r3;
        }
        function p2(e3, t3) {
          return { type: e3, value: t3 || "", start: o2, end: o2 + 1, column: s2, line: u2 };
        }
        function h2() {
          while (q() && !n.isNewline(q())) {
            R();
          }
          R();
        }
        function v2() {
          while (q() && !(q() === "*" && I() === "/")) {
            R();
          }
          R();
          R();
        }
        function d2() {
          var e3 = p2("CLASS_REF");
          var t3 = R();
          if (q() === "{") {
            e3.template = true;
            t3 += R();
            while (q() && q() !== "}") {
              t3 += R();
            }
            if (q() !== "}") {
              throw Error("Unterminated class reference");
            } else {
              t3 += R();
            }
          } else {
            while (n.isValidCSSClassChar(q()) || q() === "\\") {
              if (q() === "\\") {
                R();
              }
              t3 += R();
            }
          }
          e3.value = t3;
          e3.end = o2;
          return e3;
        }
        function E2() {
          var e3 = p2("ATTRIBUTE_REF");
          var t3 = R();
          while (o2 < a2.length && q() !== "]") {
            t3 += R();
          }
          if (q() === "]") {
            t3 += R();
          }
          e3.value = t3;
          e3.end = o2;
          return e3;
        }
        function T2() {
          var e3 = p2("ATTRIBUTE_REF");
          var t3 = R();
          while (n.isValidCSSIDChar(q())) {
            t3 += R();
          }
          if (q() === "=") {
            t3 += R();
            if (q() === '"' || q() === "'") {
              let e4 = S2();
              t3 += e4.value;
            } else if (n.isAlpha(q()) || n.isNumeric(q()) || n.isIdentifierChar(q())) {
              let e4 = g2();
              t3 += e4.value;
            }
          }
          e3.value = t3;
          e3.end = o2;
          return e3;
        }
        function y2() {
          var e3 = p2("STYLE_REF");
          var t3 = R();
          while (n.isAlpha(q()) || q() === "-") {
            t3 += R();
          }
          e3.value = t3;
          e3.end = o2;
          return e3;
        }
        function k2() {
          var e3 = p2("ID_REF");
          var t3 = R();
          if (q() === "{") {
            e3.template = true;
            t3 += R();
            while (q() && q() !== "}") {
              t3 += R();
            }
            if (q() !== "}") {
              throw Error("Unterminated id reference");
            } else {
              R();
            }
          } else {
            while (n.isValidCSSIDChar(q())) {
              t3 += R();
            }
          }
          e3.value = t3;
          e3.end = o2;
          return e3;
        }
        function x2() {
          var e3 = p2("IDENTIFIER");
          var t3 = R();
          var r3 = t3 === "\\";
          if (r3) {
            t3 = "";
          }
          while (n.isAlpha(q()) || n.isNumeric(q()) || n.isIdentifierChar(q()) || q() === "\\" || q() === "{" || q() === "}") {
            if (q() === "$" && r3 === false) {
              break;
            } else if (q() === "\\") {
              r3 = true;
              R();
            } else {
              r3 = false;
              t3 += R();
            }
          }
          if (q() === "!" && t3 === "beep") {
            t3 += R();
          }
          e3.value = t3;
          e3.end = o2;
          return e3;
        }
        function g2() {
          var e3 = p2("IDENTIFIER");
          var t3 = R();
          while (n.isAlpha(q()) || n.isNumeric(q()) || n.isIdentifierChar(q())) {
            t3 += R();
          }
          if (q() === "!" && t3 === "beep") {
            t3 += R();
          }
          e3.value = t3;
          e3.end = o2;
          return e3;
        }
        function b2() {
          var e3 = p2("NUMBER");
          var t3 = R();
          while (n.isNumeric(q())) {
            t3 += R();
          }
          if (q() === "." && n.isNumeric(I())) {
            t3 += R();
          }
          while (n.isNumeric(q())) {
            t3 += R();
          }
          if (q() === "e" || q() === "E") {
            if (n.isNumeric(I())) {
              t3 += R();
            } else if (I() === "-") {
              t3 += R();
              t3 += R();
            }
          }
          while (n.isNumeric(q())) {
            t3 += R();
          }
          e3.value = t3;
          e3.end = o2;
          return e3;
        }
        function w2() {
          var e3 = m2();
          var t3 = R();
          while (q() && n.OP_TABLE[t3 + q()]) {
            t3 += R();
          }
          e3.type = n.OP_TABLE[t3];
          e3.value = t3;
          e3.end = o2;
          return e3;
        }
        function S2() {
          var e3 = p2("STRING");
          var t3 = R();
          e3.template = t3 === "`";
          var r3 = "";
          while (q() && q() !== t3) {
            if (q() === "\\") {
              R();
              let t4 = R();
              if (t4 === "b") {
                r3 += "\b";
              } else if (t4 === "f") {
                r3 += "\f";
              } else if (t4 === "n") {
                r3 += `
`;
              } else if (t4 === "r") {
                r3 += "\r";
              } else if (t4 === "t") {
                r3 += "\t";
              } else if (t4 === "v") {
                r3 += "\v";
              } else if (e3.template && t4 === "$") {
                r3 += "\\$";
              } else if (t4 === "x") {
                const t5 = N();
                if (Number.isNaN(t5)) {
                  throw Error("Invalid hexadecimal escape at " + n.positionString(e3));
                }
                r3 += String.fromCharCode(t5);
              } else {
                r3 += t4;
              }
            } else {
              r3 += R();
            }
          }
          if (q() !== t3) {
            throw Error("Unterminated string at " + n.positionString(e3));
          } else {
            R();
          }
          e3.value = r3;
          e3.end = o2;
          return e3;
        }
        function N() {
          const e3 = 16;
          if (!q()) {
            return NaN;
          }
          let t3 = e3 * Number.parseInt(R(), e3);
          if (!q()) {
            return NaN;
          }
          t3 += Number.parseInt(R(), e3);
          return t3;
        }
        function q() {
          return a2.charAt(o2);
        }
        function I() {
          return a2.charAt(o2 + 1);
        }
        function C(e3 = 1) {
          return a2.charAt(o2 + e3);
        }
        function R() {
          l2 = q();
          o2++;
          s2++;
          return l2;
        }
        function A() {
          return n.isAlpha(l2) || n.isNumeric(l2) || l2 === ")" || l2 === '"' || l2 === "'" || l2 === "`" || l2 === "}" || l2 === "]";
        }
        function L() {
          var e3 = p2("WHITESPACE");
          var t3 = "";
          while (q() && n.isWhitespace(q())) {
            if (n.isNewline(q())) {
              s2 = 0;
              u2++;
            }
            t3 += R();
          }
          e3.value = t3;
          e3.end = o2;
          return e3;
        }
      }
      tokenize(e2, t2) {
        return n.tokenize(e2, t2);
      }
    }

    class i {
      constructor(e2, t2, r2) {
        this.tokens = e2;
        this.consumed = t2;
        this.source = r2;
        this.consumeWhitespace();
      }
      get list() {
        return this.tokens;
      }
      _lastConsumed = null;
      consumeWhitespace() {
        while (this.token(0, true).type === "WHITESPACE") {
          this.consumed.push(this.tokens.shift());
        }
      }
      raiseError(e2, t2) {
        a.raiseParseError(e2, t2);
      }
      requireOpToken(e2) {
        var t2 = this.matchOpToken(e2);
        if (t2) {
          return t2;
        } else {
          this.raiseError(this, "Expected '" + e2 + "' but found '" + this.currentToken().value + "'");
        }
      }
      matchAnyOpToken(e2, t2, r2) {
        for (var n2 = 0;n2 < arguments.length; n2++) {
          var i2 = arguments[n2];
          var a2 = this.matchOpToken(i2);
          if (a2) {
            return a2;
          }
        }
      }
      matchAnyToken(e2, t2, r2) {
        for (var n2 = 0;n2 < arguments.length; n2++) {
          var i2 = arguments[n2];
          var a2 = this.matchToken(i2);
          if (a2) {
            return a2;
          }
        }
      }
      matchOpToken(e2) {
        if (this.currentToken() && this.currentToken().op && this.currentToken().value === e2) {
          return this.consumeToken();
        }
      }
      requireTokenType(e2, t2, r2, n2) {
        var i2 = this.matchTokenType(e2, t2, r2, n2);
        if (i2) {
          return i2;
        } else {
          this.raiseError(this, "Expected one of " + JSON.stringify([e2, t2, r2]));
        }
      }
      matchTokenType(e2, t2, r2, n2) {
        if (this.currentToken() && this.currentToken().type && [e2, t2, r2, n2].indexOf(this.currentToken().type) >= 0) {
          return this.consumeToken();
        }
      }
      requireToken(e2, t2) {
        var r2 = this.matchToken(e2, t2);
        if (r2) {
          return r2;
        } else {
          this.raiseError(this, "Expected '" + e2 + "' but found '" + this.currentToken().value + "'");
        }
      }
      peekToken(e2, t2, r2) {
        t2 = t2 || 0;
        r2 = r2 || "IDENTIFIER";
        if (this.tokens[t2] && this.tokens[t2].value === e2 && this.tokens[t2].type === r2) {
          return this.tokens[t2];
        }
      }
      matchToken(e2, t2) {
        if (this.follows.indexOf(e2) !== -1) {
          return;
        }
        t2 = t2 || "IDENTIFIER";
        if (this.currentToken() && this.currentToken().value === e2 && this.currentToken().type === t2) {
          return this.consumeToken();
        }
      }
      consumeToken() {
        var e2 = this.tokens.shift();
        this.consumed.push(e2);
        this._lastConsumed = e2;
        this.consumeWhitespace();
        return e2;
      }
      consumeUntil(e2, t2) {
        var r2 = [];
        var n2 = this.token(0, true);
        while ((t2 == null || n2.type !== t2) && (e2 == null || n2.value !== e2) && n2.type !== "EOF") {
          var i2 = this.tokens.shift();
          this.consumed.push(i2);
          r2.push(n2);
          n2 = this.token(0, true);
        }
        this.consumeWhitespace();
        return r2;
      }
      lastWhitespace() {
        if (this.consumed[this.consumed.length - 1] && this.consumed[this.consumed.length - 1].type === "WHITESPACE") {
          return this.consumed[this.consumed.length - 1].value;
        } else {
          return "";
        }
      }
      consumeUntilWhitespace() {
        return this.consumeUntil(null, "WHITESPACE");
      }
      hasMore() {
        return this.tokens.length > 0;
      }
      token(e2, t2) {
        var r2;
        var n2 = 0;
        do {
          if (!t2) {
            while (this.tokens[n2] && this.tokens[n2].type === "WHITESPACE") {
              n2++;
            }
          }
          r2 = this.tokens[n2];
          e2--;
          n2++;
        } while (e2 > -1);
        if (r2) {
          return r2;
        } else {
          return { type: "EOF", value: "<<<EOF>>>" };
        }
      }
      currentToken() {
        return this.token(0);
      }
      lastMatch() {
        return this._lastConsumed;
      }
      static sourceFor = function() {
        return this.programSource.substring(this.startToken.start, this.endToken.end);
      };
      static lineFor = function() {
        return this.programSource.split(`
`)[this.startToken.line - 1];
      };
      follows = [];
      pushFollow(e2) {
        this.follows.push(e2);
      }
      popFollow() {
        this.follows.pop();
      }
      clearFollows() {
        var e2 = this.follows;
        this.follows = [];
        return e2;
      }
      restoreFollows(e2) {
        this.follows = e2;
      }
    }

    class a {
      constructor(e2) {
        this.runtime = e2;
        this.possessivesDisabled = false;
        this.addGrammarElement("feature", function(e3, t2, r2) {
          if (r2.matchOpToken("(")) {
            var n2 = e3.requireElement("feature", r2);
            r2.requireOpToken(")");
            return n2;
          }
          var i2 = e3.FEATURES[r2.currentToken().value || ""];
          if (i2) {
            return i2(e3, t2, r2);
          }
        });
        this.addGrammarElement("command", function(e3, t2, r2) {
          if (r2.matchOpToken("(")) {
            const t3 = e3.requireElement("command", r2);
            r2.requireOpToken(")");
            return t3;
          }
          var n2 = e3.COMMANDS[r2.currentToken().value || ""];
          let i2;
          if (n2) {
            i2 = n2(e3, t2, r2);
          } else if (r2.currentToken().type === "IDENTIFIER") {
            i2 = e3.parseElement("pseudoCommand", r2);
          }
          if (i2) {
            return e3.parseElement("indirectStatement", r2, i2);
          }
          return i2;
        });
        this.addGrammarElement("commandList", function(e3, t2, r2) {
          if (r2.hasMore()) {
            var n2 = e3.parseElement("command", r2);
            if (n2) {
              r2.matchToken("then");
              const t3 = e3.parseElement("commandList", r2);
              if (t3)
                n2.next = t3;
              return n2;
            }
          }
          return { type: "emptyCommandListCommand", op: function(e4) {
            return t2.findNext(this, e4);
          }, execute: function(e4) {
            return t2.unifiedExec(this, e4);
          } };
        });
        this.addGrammarElement("leaf", function(e3, t2, r2) {
          var n2 = e3.parseAnyOf(e3.LEAF_EXPRESSIONS, r2);
          if (n2 == null) {
            return e3.parseElement("symbol", r2);
          }
          return n2;
        });
        this.addGrammarElement("indirectExpression", function(e3, t2, r2, n2) {
          for (var i2 = 0;i2 < e3.INDIRECT_EXPRESSIONS.length; i2++) {
            var a2 = e3.INDIRECT_EXPRESSIONS[i2];
            n2.endToken = r2.lastMatch();
            var o2 = e3.parseElement(a2, r2, n2);
            if (o2) {
              return o2;
            }
          }
          return n2;
        });
        this.addGrammarElement("indirectStatement", function(e3, t2, r2, n2) {
          if (r2.matchToken("unless")) {
            n2.endToken = r2.lastMatch();
            var i2 = e3.requireElement("expression", r2);
            var a2 = { type: "unlessStatementModifier", args: [i2], op: function(e4, t3) {
              if (t3) {
                return this.next;
              } else {
                return n2;
              }
            }, execute: function(e4) {
              return t2.unifiedExec(this, e4);
            } };
            n2.parent = a2;
            return a2;
          }
          return n2;
        });
        this.addGrammarElement("primaryExpression", function(e3, t2, r2) {
          var n2 = e3.parseElement("leaf", r2);
          if (n2) {
            return e3.parseElement("indirectExpression", r2, n2);
          }
          e3.raiseParseError(r2, "Unexpected value: " + r2.currentToken().value);
        });
      }
      use(e2) {
        e2(this);
        return this;
      }
      GRAMMAR = {};
      COMMANDS = {};
      FEATURES = {};
      LEAF_EXPRESSIONS = [];
      INDIRECT_EXPRESSIONS = [];
      initElt(e2, t2, r2) {
        e2.startToken = t2;
        e2.sourceFor = i.sourceFor;
        e2.lineFor = i.lineFor;
        e2.programSource = r2.source;
      }
      parseElement(e2, t2, r2 = undefined) {
        var n2 = this.GRAMMAR[e2];
        if (n2) {
          var i2 = t2.currentToken();
          var a2 = n2(this, this.runtime, t2, r2);
          if (a2) {
            this.initElt(a2, i2, t2);
            a2.endToken = a2.endToken || t2.lastMatch();
            var r2 = a2.root;
            while (r2 != null) {
              this.initElt(r2, i2, t2);
              r2 = r2.root;
            }
          }
          return a2;
        }
      }
      requireElement(e2, t2, r2, n2) {
        var i2 = this.parseElement(e2, t2, n2);
        if (!i2)
          a.raiseParseError(t2, r2 || "Expected " + e2);
        return i2;
      }
      parseAnyOf(e2, t2) {
        for (var r2 = 0;r2 < e2.length; r2++) {
          var n2 = e2[r2];
          var i2 = this.parseElement(n2, t2);
          if (i2) {
            return i2;
          }
        }
      }
      addGrammarElement(e2, t2) {
        this.GRAMMAR[e2] = t2;
      }
      addCommand(e2, t2) {
        var r2 = e2 + "Command";
        var n2 = function(e3, n3, i2) {
          const a2 = t2(e3, n3, i2);
          if (a2) {
            a2.type = r2;
            a2.execute = function(e4) {
              e4.meta.command = a2;
              return n3.unifiedExec(this, e4);
            };
            return a2;
          }
        };
        this.GRAMMAR[r2] = n2;
        this.COMMANDS[e2] = n2;
      }
      addFeature(e2, t2) {
        var r2 = e2 + "Feature";
        var n2 = function(n3, i2, a2) {
          var o2 = t2(n3, i2, a2);
          if (o2) {
            o2.isFeature = true;
            o2.keyword = e2;
            o2.type = r2;
            return o2;
          }
        };
        this.GRAMMAR[r2] = n2;
        this.FEATURES[e2] = n2;
      }
      addLeafExpression(e2, t2) {
        this.LEAF_EXPRESSIONS.push(e2);
        this.addGrammarElement(e2, t2);
      }
      addIndirectExpression(e2, t2) {
        this.INDIRECT_EXPRESSIONS.push(e2);
        this.addGrammarElement(e2, t2);
      }
      static createParserContext(e2) {
        var t2 = e2.currentToken();
        var r2 = e2.source;
        var n2 = r2.split(`
`);
        var i2 = t2 && t2.line ? t2.line - 1 : n2.length - 1;
        var a2 = n2[i2];
        var o2 = t2 && t2.line ? t2.column : a2.length - 1;
        return a2 + `
` + " ".repeat(o2) + `^^

`;
      }
      static raiseParseError(e2, t2) {
        t2 = (t2 || "Unexpected Token : " + e2.currentToken().value) + `

` + a.createParserContext(e2);
        var r2 = new Error(t2);
        r2["tokens"] = e2;
        throw r2;
      }
      raiseParseError(e2, t2) {
        a.raiseParseError(e2, t2);
      }
      parseHyperScript(e2) {
        var t2 = this.parseElement("hyperscript", e2);
        if (e2.hasMore())
          this.raiseParseError(e2);
        if (t2)
          return t2;
      }
      setParent(e2, t2) {
        if (typeof e2 === "object") {
          e2.parent = t2;
          if (typeof t2 === "object") {
            t2.children = t2.children || new Set;
            t2.children.add(e2);
          }
          this.setParent(e2.next, t2);
        }
      }
      commandStart(e2) {
        return this.COMMANDS[e2.value || ""];
      }
      featureStart(e2) {
        return this.FEATURES[e2.value || ""];
      }
      commandBoundary(e2) {
        if (e2.value == "end" || e2.value == "then" || e2.value == "else" || e2.value == "otherwise" || e2.value == ")" || this.commandStart(e2) || this.featureStart(e2) || e2.type == "EOF") {
          return true;
        }
        return false;
      }
      parseStringTemplate(e2) {
        var t2 = [""];
        do {
          t2.push(e2.lastWhitespace());
          if (e2.currentToken().value === "$") {
            e2.consumeToken();
            var r2 = e2.matchOpToken("{");
            t2.push(this.requireElement("expression", e2));
            if (r2) {
              e2.requireOpToken("}");
            }
            t2.push("");
          } else if (e2.currentToken().value === "\\") {
            e2.consumeToken();
            e2.consumeToken();
          } else {
            var n2 = e2.consumeToken();
            t2[t2.length - 1] += n2 ? n2.value : "";
          }
        } while (e2.hasMore());
        t2.push(e2.lastWhitespace());
        return t2;
      }
      ensureTerminated(e2) {
        const t2 = this.runtime;
        var r2 = { type: "implicitReturn", op: function(e3) {
          e3.meta.returned = true;
          if (e3.meta.resolve) {
            e3.meta.resolve();
          }
          return t2.HALT;
        }, execute: function(e3) {} };
        var n2 = e2;
        while (n2.next) {
          n2 = n2.next;
        }
        n2.next = r2;
      }
    }

    class o {
      constructor(e2, t2) {
        this.lexer = e2 ?? new n;
        this.parser = t2 ?? new a(this).use(T).use(y);
        this.parser.runtime = this;
      }
      matchesSelector(e2, t2) {
        var r2 = e2.matches || e2.matchesSelector || e2.msMatchesSelector || e2.mozMatchesSelector || e2.webkitMatchesSelector || e2.oMatchesSelector;
        return r2 && r2.call(e2, t2);
      }
      makeEvent(t2, r2) {
        var n2;
        if (e.Event && typeof e.Event === "function") {
          n2 = new Event(t2, { bubbles: true, cancelable: true, composed: true });
          n2["detail"] = r2;
        } else {
          n2 = document.createEvent("CustomEvent");
          n2.initCustomEvent(t2, true, true, r2);
        }
        return n2;
      }
      triggerEvent(e2, t2, r2, n2) {
        r2 = r2 || {};
        r2["sender"] = n2;
        var i2 = this.makeEvent(t2, r2);
        var a2 = e2.dispatchEvent(i2);
        return a2;
      }
      isArrayLike(e2) {
        return Array.isArray(e2) || typeof NodeList !== "undefined" && (e2 instanceof NodeList || e2 instanceof HTMLCollection || e2 instanceof FileList);
      }
      isIterable(e2) {
        return typeof e2 === "object" && Symbol.iterator in e2 && typeof e2[Symbol.iterator] === "function";
      }
      shouldAutoIterate(e2) {
        return e2 != null && e2[p] || this.isArrayLike(e2);
      }
      forEach(e2, t2) {
        if (e2 == null) {} else if (this.isIterable(e2)) {
          for (const r3 of e2) {
            t2(r3);
          }
        } else if (this.isArrayLike(e2)) {
          for (var r2 = 0;r2 < e2.length; r2++) {
            t2(e2[r2]);
          }
        } else {
          t2(e2);
        }
      }
      implicitLoop(e2, t2) {
        if (this.shouldAutoIterate(e2)) {
          for (const r2 of e2)
            t2(r2);
        } else {
          t2(e2);
        }
      }
      wrapArrays(e2) {
        var t2 = [];
        for (var r2 = 0;r2 < e2.length; r2++) {
          var n2 = e2[r2];
          if (Array.isArray(n2)) {
            t2.push(Promise.all(n2));
          } else {
            t2.push(n2);
          }
        }
        return t2;
      }
      unwrapAsyncs(e2) {
        for (var t2 = 0;t2 < e2.length; t2++) {
          var r2 = e2[t2];
          if (r2.asyncWrapper) {
            e2[t2] = r2.value;
          }
          if (Array.isArray(r2)) {
            for (var n2 = 0;n2 < r2.length; n2++) {
              var i2 = r2[n2];
              if (i2.asyncWrapper) {
                r2[n2] = i2.value;
              }
            }
          }
        }
      }
      static HALT = {};
      HALT = o.HALT;
      unifiedExec(e2, t2) {
        while (true) {
          try {
            var r2 = this.unifiedEval(e2, t2);
          } catch (n2) {
            if (t2.meta.handlingFinally) {
              console.error(" Exception in finally block: ", n2);
              r2 = o.HALT;
            } else {
              this.registerHyperTrace(t2, n2);
              if (t2.meta.errorHandler && !t2.meta.handlingError) {
                t2.meta.handlingError = true;
                t2.locals[t2.meta.errorSymbol] = n2;
                e2 = t2.meta.errorHandler;
                continue;
              } else {
                t2.meta.currentException = n2;
                r2 = o.HALT;
              }
            }
          }
          if (r2 == null) {
            console.error(e2, " did not return a next element to execute! context: ", t2);
            return;
          } else if (r2.then) {
            r2.then((e3) => {
              this.unifiedExec(e3, t2);
            }).catch((e3) => {
              this.unifiedExec({ op: function() {
                throw e3;
              } }, t2);
            });
            return;
          } else if (r2 === o.HALT) {
            if (t2.meta.finallyHandler && !t2.meta.handlingFinally) {
              t2.meta.handlingFinally = true;
              e2 = t2.meta.finallyHandler;
            } else {
              if (t2.meta.onHalt) {
                t2.meta.onHalt();
              }
              if (t2.meta.currentException) {
                if (t2.meta.reject) {
                  t2.meta.reject(t2.meta.currentException);
                  return;
                } else {
                  throw t2.meta.currentException;
                }
              } else {
                return;
              }
            }
          } else {
            e2 = r2;
          }
        }
      }
      unifiedEval(e2, t2, r2) {
        var n2 = [t2];
        var i2 = false;
        var a2 = false;
        if (e2.args) {
          for (var o2 = 0;o2 < e2.args.length; o2++) {
            var s2 = e2.args[o2];
            if (s2 == null) {
              n2.push(null);
            } else if (Array.isArray(s2)) {
              var u2 = [];
              for (var l2 = 0;l2 < s2.length; l2++) {
                var c2 = s2[l2];
                var f2 = c2 ? c2.evaluate(t2) : null;
                if (f2) {
                  if (f2.then) {
                    i2 = true;
                  } else if (f2.asyncWrapper) {
                    a2 = true;
                  }
                }
                u2.push(f2);
              }
              n2.push(u2);
            } else if (s2.evaluate) {
              var f2 = s2.evaluate(t2);
              if (f2) {
                if (f2.then) {
                  i2 = true;
                } else if (f2.asyncWrapper) {
                  a2 = true;
                }
              }
              n2.push(f2);
              if (f2) {
                if (r2 === true) {
                  break;
                }
              } else {
                if (r2 === false) {
                  break;
                }
              }
            } else {
              n2.push(s2);
            }
          }
        }
        if (i2) {
          return new Promise((t3, r3) => {
            n2 = this.wrapArrays(n2);
            Promise.all(n2).then(function(n3) {
              if (a2) {
                this.unwrapAsyncs(n3);
              }
              try {
                var i3 = e2.op.apply(e2, n3);
                t3(i3);
              } catch (e3) {
                r3(e3);
              }
            }).catch(function(e3) {
              r3(e3);
            });
          });
        } else {
          if (a2) {
            this.unwrapAsyncs(n2);
          }
          return e2.op.apply(e2, n2);
        }
      }
      _scriptAttrs = null;
      getScriptAttributes() {
        if (this._scriptAttrs == null) {
          this._scriptAttrs = r.attributes.replace(/ /g, "").split(",");
        }
        return this._scriptAttrs;
      }
      getScript(e2) {
        for (var t2 = 0;t2 < this.getScriptAttributes().length; t2++) {
          var r2 = this.getScriptAttributes()[t2];
          if (e2.hasAttribute && e2.hasAttribute(r2)) {
            return e2.getAttribute(r2);
          }
        }
        if (e2 instanceof HTMLScriptElement && e2.type === "text/hyperscript") {
          return e2.innerText;
        }
        return null;
      }
      hyperscriptFeaturesMap = new WeakMap;
      getHyperscriptFeatures(e2) {
        var t2 = this.hyperscriptFeaturesMap.get(e2);
        if (typeof t2 === "undefined") {
          if (e2) {
            this.hyperscriptFeaturesMap.set(e2, t2 = {});
          }
        }
        return t2;
      }
      addFeatures(e2, t2) {
        if (e2) {
          Object.assign(t2.locals, this.getHyperscriptFeatures(e2));
          this.addFeatures(e2.parentElement, t2);
        }
      }
      makeContext(e2, t2, r2, n2) {
        return new f(e2, t2, r2, n2, this);
      }
      getScriptSelector() {
        return this.getScriptAttributes().map(function(e2) {
          return "[" + e2 + "]";
        }).join(", ");
      }
      convertValue(e2, r2) {
        var n2 = t.dynamicResolvers;
        for (var i2 = 0;i2 < n2.length; i2++) {
          var a2 = n2[i2];
          var o2 = a2(r2, e2);
          if (o2 !== undefined) {
            return o2;
          }
        }
        if (e2 == null) {
          return null;
        }
        var s2 = t[r2];
        if (s2) {
          return s2(e2);
        }
        throw "Unknown conversion : " + r2;
      }
      parse(e2) {
        const t2 = this.lexer, r2 = this.parser;
        var n2 = t2.tokenize(e2);
        if (this.parser.commandStart(n2.currentToken())) {
          var i2 = r2.requireElement("commandList", n2);
          if (n2.hasMore())
            r2.raiseParseError(n2);
          r2.ensureTerminated(i2);
          return i2;
        } else if (r2.featureStart(n2.currentToken())) {
          var a2 = r2.requireElement("hyperscript", n2);
          if (n2.hasMore())
            r2.raiseParseError(n2);
          return a2;
        } else {
          var o2 = r2.requireElement("expression", n2);
          if (n2.hasMore())
            r2.raiseParseError(n2);
          return o2;
        }
      }
      evaluateNoPromise(e2, t2) {
        let r2 = e2.evaluate(t2);
        if (r2.next) {
          throw new Error(i.sourceFor.call(e2) + " returned a Promise in a context that they are not allowed.");
        }
        return r2;
      }
      evaluate(t2, r2, n2) {

        class i2 extends EventTarget {
          constructor(e2) {
            super();
            this.module = e2;
          }
          toString() {
            return this.module.id;
          }
        }
        var a2 = "document" in e ? e.document.body : new i2(n2 && n2.module);
        r2 = Object.assign(this.makeContext(a2, null, a2, null), r2 || {});
        var o2 = this.parse(t2);
        if (o2.execute) {
          o2.execute(r2);
          if (typeof r2.meta.returnValue !== "undefined") {
            return r2.meta.returnValue;
          } else {
            return r2.result;
          }
        } else if (o2.apply) {
          o2.apply(a2, a2, n2);
          return this.getHyperscriptFeatures(a2);
        } else {
          return o2.evaluate(r2);
        }
        function s2() {
          return {};
        }
      }
      processNode(e2) {
        var t2 = this.getScriptSelector();
        if (this.matchesSelector(e2, t2)) {
          this.initElement(e2, e2);
        }
        if (e2 instanceof HTMLScriptElement && e2.type === "text/hyperscript") {
          this.initElement(e2, document.body);
        }
        if (e2.querySelectorAll) {
          this.forEach(e2.querySelectorAll(t2 + ", [type='text/hyperscript']"), (e3) => {
            this.initElement(e3, e3 instanceof HTMLScriptElement && e3.type === "text/hyperscript" ? document.body : e3);
          });
        }
      }
      initElement(e2, t2) {
        if (e2.closest && e2.closest(r.disableSelector)) {
          return;
        }
        var n2 = this.getInternalData(e2);
        if (!n2.initialized) {
          var i2 = this.getScript(e2);
          if (i2) {
            try {
              n2.initialized = true;
              n2.script = i2;
              const r2 = this.lexer, s2 = this.parser;
              var a2 = r2.tokenize(i2);
              var o2 = s2.parseHyperScript(a2);
              if (!o2)
                return;
              o2.apply(t2 || e2, e2);
              setTimeout(() => {
                this.triggerEvent(t2 || e2, "load", { hyperscript: true });
              }, 1);
            } catch (t3) {
              this.triggerEvent(e2, "exception", { error: t3 });
              console.error("hyperscript errors were found on the following element:", e2, `

`, t3.message, t3.stack);
            }
          }
        }
      }
      internalDataMap = new WeakMap;
      getInternalData(e2) {
        var t2 = this.internalDataMap.get(e2);
        if (typeof t2 === "undefined") {
          this.internalDataMap.set(e2, t2 = {});
        }
        return t2;
      }
      typeCheck(e2, t2, r2) {
        if (e2 == null && r2) {
          return true;
        }
        var n2 = Object.prototype.toString.call(e2).slice(8, -1);
        return n2 === t2;
      }
      getElementScope(e2) {
        var t2 = e2.meta && e2.meta.owner;
        if (t2) {
          var r2 = this.getInternalData(t2);
          var n2 = "elementScope";
          if (e2.meta.feature && e2.meta.feature.behavior) {
            n2 = e2.meta.feature.behavior + "Scope";
          }
          var i2 = h(r2, n2);
          return i2;
        } else {
          return {};
        }
      }
      isReservedWord(e2) {
        return ["meta", "it", "result", "locals", "event", "target", "detail", "sender", "body"].includes(e2);
      }
      isHyperscriptContext(e2) {
        return e2 instanceof f;
      }
      resolveSymbol(t2, r2, n2) {
        if (t2 === "me" || t2 === "my" || t2 === "I") {
          return r2.me;
        }
        if (t2 === "it" || t2 === "its" || t2 === "result") {
          return r2.result;
        }
        if (t2 === "you" || t2 === "your" || t2 === "yourself") {
          return r2.you;
        } else {
          if (n2 === "global") {
            return e[t2];
          } else if (n2 === "element") {
            var i2 = this.getElementScope(r2);
            return i2[t2];
          } else if (n2 === "local") {
            return r2.locals[t2];
          } else {
            if (r2.meta && r2.meta.context) {
              var a2 = r2.meta.context[t2];
              if (typeof a2 !== "undefined") {
                return a2;
              }
              if (r2.meta.context.detail) {
                a2 = r2.meta.context.detail[t2];
                if (typeof a2 !== "undefined") {
                  return a2;
                }
              }
            }
            if (this.isHyperscriptContext(r2) && !this.isReservedWord(t2)) {
              var o2 = r2.locals[t2];
            } else {
              var o2 = r2[t2];
            }
            if (typeof o2 !== "undefined") {
              return o2;
            } else {
              var i2 = this.getElementScope(r2);
              o2 = i2[t2];
              if (typeof o2 !== "undefined") {
                return o2;
              } else {
                return e[t2];
              }
            }
          }
        }
      }
      setSymbol(t2, r2, n2, i2) {
        if (n2 === "global") {
          e[t2] = i2;
        } else if (n2 === "element") {
          var a2 = this.getElementScope(r2);
          a2[t2] = i2;
        } else if (n2 === "local") {
          r2.locals[t2] = i2;
        } else {
          if (this.isHyperscriptContext(r2) && !this.isReservedWord(t2) && typeof r2.locals[t2] !== "undefined") {
            r2.locals[t2] = i2;
          } else {
            var a2 = this.getElementScope(r2);
            var o2 = a2[t2];
            if (typeof o2 !== "undefined") {
              a2[t2] = i2;
            } else {
              if (this.isHyperscriptContext(r2) && !this.isReservedWord(t2)) {
                r2.locals[t2] = i2;
              } else {
                r2[t2] = i2;
              }
            }
          }
        }
      }
      findNext(e2, t2) {
        if (e2) {
          if (e2.resolveNext) {
            return e2.resolveNext(t2);
          } else if (e2.next) {
            return e2.next;
          } else {
            return this.findNext(e2.parent, t2);
          }
        }
      }
      flatGet(e2, t2, r2) {
        if (e2 != null) {
          var n2 = r2(e2, t2);
          if (typeof n2 !== "undefined") {
            return n2;
          }
          if (this.shouldAutoIterate(e2)) {
            var i2 = [];
            for (var a2 of e2) {
              var o2 = r2(a2, t2);
              i2.push(o2);
            }
            return i2;
          }
        }
      }
      resolveProperty(e2, t2) {
        return this.flatGet(e2, t2, (e3, t3) => e3[t3]);
      }
      resolveAttribute(e2, t2) {
        return this.flatGet(e2, t2, (e3, t3) => e3.getAttribute && e3.getAttribute(t3));
      }
      resolveStyle(e2, t2) {
        return this.flatGet(e2, t2, (e3, t3) => e3.style && e3.style[t3]);
      }
      resolveComputedStyle(e2, t2) {
        return this.flatGet(e2, t2, (e3, t3) => getComputedStyle(e3).getPropertyValue(t3));
      }
      assignToNamespace(t2, r2, n2, i2) {
        let a2;
        if (typeof document !== "undefined" && t2 === document.body) {
          a2 = e;
        } else {
          a2 = this.getHyperscriptFeatures(t2);
        }
        var o2;
        while ((o2 = r2.shift()) !== undefined) {
          var s2 = a2[o2];
          if (s2 == null) {
            s2 = {};
            a2[o2] = s2;
          }
          a2 = s2;
        }
        a2[n2] = i2;
      }
      getHyperTrace(e2, t2) {
        var r2 = [];
        var n2 = e2;
        while (n2.meta.caller) {
          n2 = n2.meta.caller;
        }
        if (n2.meta.traceMap) {
          return n2.meta.traceMap.get(t2, r2);
        }
      }
      registerHyperTrace(e2, t2) {
        var r2 = [];
        var n2 = null;
        while (e2 != null) {
          r2.push(e2);
          n2 = e2;
          e2 = e2.meta.caller;
        }
        if (n2.meta.traceMap == null) {
          n2.meta.traceMap = new Map;
        }
        if (!n2.meta.traceMap.get(t2)) {
          var i2 = { trace: r2, print: function(e3) {
            e3 = e3 || console.error;
            e3("hypertrace /// ");
            var t3 = 0;
            for (var n3 = 0;n3 < r2.length; n3++) {
              t3 = Math.max(t3, r2[n3].meta.feature.displayName.length);
            }
            for (var n3 = 0;n3 < r2.length; n3++) {
              var i3 = r2[n3];
              e3("  ->", i3.meta.feature.displayName.padEnd(t3 + 2), "-", i3.meta.owner);
            }
          } };
          n2.meta.traceMap.set(t2, i2);
        }
      }
      escapeSelector(e2) {
        return e2.replace(/[:&()\[\]\/]/g, function(e3) {
          return "\\" + e3;
        });
      }
      nullCheck(e2, t2) {
        if (e2 == null) {
          throw new Error("'" + t2.sourceFor() + "' is null");
        }
      }
      isEmpty(e2) {
        return e2 == undefined || e2.length === 0;
      }
      doesExist(e2) {
        if (e2 == null) {
          return false;
        }
        if (this.shouldAutoIterate(e2)) {
          for (const t2 of e2) {
            return true;
          }
          return false;
        }
        return true;
      }
      getRootNode(e2) {
        if (e2 && e2 instanceof Node) {
          var t2 = e2.getRootNode();
          if (t2 instanceof Document || t2 instanceof ShadowRoot)
            return t2;
        }
        return document;
      }
      getEventQueueFor(e2, t2) {
        let r2 = this.getInternalData(e2);
        var n2 = r2.eventQueues;
        if (n2 == null) {
          n2 = new Map;
          r2.eventQueues = n2;
        }
        var i2 = n2.get(t2);
        if (i2 == null) {
          i2 = { queue: [], executing: false };
          n2.set(t2, i2);
        }
        return i2;
      }
      beepValueToConsole(e2, t2, r2) {
        if (this.triggerEvent(e2, "hyperscript:beep", { element: e2, expression: t2, value: r2 })) {
          var n2;
          if (r2) {
            if (r2 instanceof m) {
              n2 = "ElementCollection";
            } else if (r2.constructor) {
              n2 = r2.constructor.name;
            } else {
              n2 = "unknown";
            }
          } else {
            n2 = "object (null)";
          }
          var a2 = r2;
          if (n2 === "String") {
            a2 = '"' + a2 + '"';
          } else if (r2 instanceof m) {
            a2 = Array.from(r2);
          }
          console.log("///_ BEEP! The expression (" + i.sourceFor.call(t2).replace("beep! ", "") + ") evaluates to:", a2, "of type " + n2);
        }
      }
      hyperscriptUrl = "document" in e && document.currentScript ? document.currentScript.src : null;
    }
    function s() {
      let e2 = document.cookie.split("; ").map((e3) => {
        let t2 = e3.split("=");
        return { name: t2[0], value: decodeURIComponent(t2[1]) };
      });
      return e2;
    }
    function u(e2) {
      document.cookie = e2 + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
    }
    function l() {
      for (const e2 of s()) {
        u(e2.name);
      }
    }
    const c = new Proxy({}, { get(e2, t2) {
      if (t2 === "then" || t2 === "asyncWrapper") {
        return null;
      } else if (t2 === "length") {
        return s().length;
      } else if (t2 === "clear") {
        return u;
      } else if (t2 === "clearAll") {
        return l;
      } else if (typeof t2 === "string") {
        if (!isNaN(t2)) {
          return s()[parseInt(t2)];
        } else {
          let e3 = document.cookie.split("; ").find((e4) => e4.startsWith(t2 + "="))?.split("=")[1];
          if (e3) {
            return decodeURIComponent(e3);
          }
        }
      } else if (t2 === Symbol.iterator) {
        return s()[t2];
      }
    }, set(e2, t2, r2) {
      var n2 = null;
      if (typeof r2 === "string") {
        n2 = encodeURIComponent(r2);
        n2 += ";samesite=lax";
      } else {
        n2 = encodeURIComponent(r2.value);
        if (r2.expires) {
          n2 += ";expires=" + r2.maxAge;
        }
        if (r2.maxAge) {
          n2 += ";max-age=" + r2.maxAge;
        }
        if (r2.partitioned) {
          n2 += ";partitioned=" + r2.partitioned;
        }
        if (r2.path) {
          n2 += ";path=" + r2.path;
        }
        if (r2.samesite) {
          n2 += ";samesite=" + r2.path;
        }
        if (r2.secure) {
          n2 += ";secure=" + r2.path;
        }
      }
      document.cookie = t2 + "=" + n2;
      return true;
    } });

    class f {
      constructor(t2, r2, n2, i2, a2) {
        this.meta = { parser: a2.parser, lexer: a2.lexer, runtime: a2, owner: t2, feature: r2, iterators: {}, ctx: this };
        this.locals = { cookies: c };
        this.me = n2, this.you = undefined;
        this.result = undefined;
        this.event = i2;
        this.target = i2 ? i2.target : null;
        this.detail = i2 ? i2.detail : null;
        this.sender = i2 ? i2.detail ? i2.detail.sender : null : null;
        this.body = "document" in e ? document.body : null;
        a2.addFeatures(t2, this);
      }
    }

    class m {
      constructor(e2, t2, r2) {
        this._css = e2;
        this.relativeToElement = t2;
        this.escape = r2;
        this[p] = true;
      }
      get css() {
        if (this.escape) {
          return o.prototype.escapeSelector(this._css);
        } else {
          return this._css;
        }
      }
      get className() {
        return this._css.substr(1);
      }
      get id() {
        return this.className();
      }
      contains(e2) {
        for (let t2 of this) {
          if (t2.contains(e2)) {
            return true;
          }
        }
        return false;
      }
      get length() {
        return this.selectMatches().length;
      }
      [Symbol.iterator]() {
        let e2 = this.selectMatches();
        return e2[Symbol.iterator]();
      }
      selectMatches() {
        let e2 = o.prototype.getRootNode(this.relativeToElement).querySelectorAll(this.css);
        return e2;
      }
    }
    const p = Symbol();
    function h(e2, t2) {
      var r2 = e2[t2];
      if (r2) {
        return r2;
      } else {
        var n2 = {};
        e2[t2] = n2;
        return n2;
      }
    }
    function v(e2) {
      try {
        return JSON.parse(e2);
      } catch (e3) {
        d(e3);
        return null;
      }
    }
    function d(e2) {
      if (console.error) {
        console.error(e2);
      } else if (console.log) {
        console.log("ERROR: ", e2);
      }
    }
    function E(e2, t2) {
      return new (e2.bind.apply(e2, [e2].concat(t2)));
    }
    function T(t2) {
      t2.addLeafExpression("parenthesized", function(e2, t3, r3) {
        if (r3.matchOpToken("(")) {
          var n2 = r3.clearFollows();
          try {
            var i2 = e2.requireElement("expression", r3);
          } finally {
            r3.restoreFollows(n2);
          }
          r3.requireOpToken(")");
          return i2;
        }
      });
      t2.addLeafExpression("string", function(e2, t3, r3) {
        var i2 = r3.matchTokenType("STRING");
        if (!i2)
          return;
        var a3 = i2.value;
        var o2;
        if (i2.template) {
          var s3 = n.tokenize(a3, true);
          o2 = e2.parseStringTemplate(s3);
        } else {
          o2 = [];
        }
        return { type: "string", token: i2, args: o2, op: function(e3) {
          var t4 = "";
          for (var r4 = 1;r4 < arguments.length; r4++) {
            var n2 = arguments[r4];
            if (n2 !== undefined) {
              t4 += n2;
            }
          }
          return t4;
        }, evaluate: function(e3) {
          if (o2.length === 0) {
            return a3;
          } else {
            return t3.unifiedEval(this, e3);
          }
        } };
      });
      t2.addGrammarElement("nakedString", function(e2, t3, r3) {
        if (r3.hasMore()) {
          var n2 = r3.consumeUntilWhitespace();
          r3.matchTokenType("WHITESPACE");
          return { type: "nakedString", tokens: n2, evaluate: function(e3) {
            return n2.map(function(e4) {
              return e4.value;
            }).join("");
          } };
        }
      });
      t2.addLeafExpression("number", function(e2, t3, r3) {
        var n2 = r3.matchTokenType("NUMBER");
        if (!n2)
          return;
        var i2 = n2;
        var a3 = parseFloat(n2.value);
        return { type: "number", value: a3, numberToken: i2, evaluate: function() {
          return a3;
        } };
      });
      t2.addLeafExpression("idRef", function(e2, t3, r3) {
        var i2 = r3.matchTokenType("ID_REF");
        if (!i2)
          return;
        if (!i2.value)
          return;
        if (i2.template) {
          var a3 = i2.value.substring(2);
          var o2 = n.tokenize(a3);
          var s3 = e2.requireElement("expression", o2);
          return { type: "idRefTemplate", args: [s3], op: function(e3, r4) {
            return t3.getRootNode(e3.me).getElementById(r4);
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
        } else {
          const e3 = i2.value.substring(1);
          return { type: "idRef", css: i2.value, value: e3, evaluate: function(r4) {
            return t3.getRootNode(r4.me).getElementById(e3);
          } };
        }
      });
      t2.addLeafExpression("classRef", function(e2, t3, r3) {
        var i2 = r3.matchTokenType("CLASS_REF");
        if (!i2)
          return;
        if (!i2.value)
          return;
        if (i2.template) {
          var a3 = i2.value.substring(2);
          var o2 = n.tokenize(a3);
          var s3 = e2.requireElement("expression", o2);
          return { type: "classRefTemplate", args: [s3], op: function(e3, t4) {
            return new m("." + t4, e3.me, true);
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
        } else {
          const e3 = i2.value;
          return { type: "classRef", css: e3, evaluate: function(t4) {
            return new m(e3, t4.me, true);
          } };
        }
      });

      class r2 extends m {
        constructor(e2, t3, r3) {
          super(e2, t3);
          this.templateParts = r3;
          this.elements = r3.filter((e3) => e3 instanceof Element);
        }
        get css() {
          let e2 = "", t3 = 0;
          for (const r3 of this.templateParts) {
            if (r3 instanceof Element) {
              e2 += "[data-hs-query-id='" + t3++ + "']";
            } else
              e2 += r3;
          }
          return e2;
        }
        [Symbol.iterator]() {
          this.elements.forEach((e3, t3) => e3.dataset.hsQueryId = t3);
          const e2 = super[Symbol.iterator]();
          this.elements.forEach((e3) => e3.removeAttribute("data-hs-query-id"));
          return e2;
        }
      }
      t2.addLeafExpression("queryRef", function(e2, t3, i2) {
        var a3 = i2.matchOpToken("<");
        if (!a3)
          return;
        var o2 = i2.consumeUntil("/");
        i2.requireOpToken("/");
        i2.requireOpToken(">");
        var s3 = o2.map(function(e3) {
          if (e3.type === "STRING") {
            return '"' + e3.value + '"';
          } else {
            return e3.value;
          }
        }).join("");
        var u3, l3, c3;
        if (/\$[^=]/.test(s3)) {
          u3 = true;
          l3 = n.tokenize(s3, true);
          c3 = e2.parseStringTemplate(l3);
        }
        return { type: "queryRef", css: s3, args: c3, op: function(e3, ...t4) {
          if (u3) {
            return new r2(s3, e3.me, t4);
          } else {
            return new m(s3, e3.me);
          }
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
      });
      t2.addLeafExpression("attributeRef", function(e2, t3, r3) {
        var n2 = r3.matchTokenType("ATTRIBUTE_REF");
        if (!n2)
          return;
        if (!n2.value)
          return;
        var i2 = n2.value;
        if (i2.indexOf("[") === 0) {
          var a3 = i2.substring(2, i2.length - 1);
        } else {
          var a3 = i2.substring(1);
        }
        var o2 = "[" + a3 + "]";
        var s3 = a3.split("=");
        var u3 = s3[0];
        var l3 = s3[1];
        if (l3) {
          if (l3.indexOf('"') === 0) {
            l3 = l3.substring(1, l3.length - 1);
          }
        }
        return { type: "attributeRef", name: u3, css: o2, value: l3, op: function(e3) {
          var t4 = e3.you || e3.me;
          if (t4) {
            return t4.getAttribute(u3);
          }
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
      });
      t2.addLeafExpression("styleRef", function(e2, t3, r3) {
        var n2 = r3.matchTokenType("STYLE_REF");
        if (!n2)
          return;
        if (!n2.value)
          return;
        var i2 = n2.value.substr(1);
        if (i2.startsWith("computed-")) {
          i2 = i2.substr("computed-".length);
          return { type: "computedStyleRef", name: i2, op: function(e3) {
            var r4 = e3.you || e3.me;
            if (r4) {
              return t3.resolveComputedStyle(r4, i2);
            }
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
        } else {
          return { type: "styleRef", name: i2, op: function(e3) {
            var r4 = e3.you || e3.me;
            if (r4) {
              return t3.resolveStyle(r4, i2);
            }
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
        }
      });
      t2.addGrammarElement("objectKey", function(e2, t3, r3) {
        var n2;
        if (n2 = r3.matchTokenType("STRING")) {
          return { type: "objectKey", key: n2.value, evaluate: function() {
            return n2.value;
          } };
        } else if (r3.matchOpToken("[")) {
          var i2 = e2.parseElement("expression", r3);
          r3.requireOpToken("]");
          return { type: "objectKey", expr: i2, args: [i2], op: function(e3, t4) {
            return t4;
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
        } else {
          var a3 = "";
          do {
            n2 = r3.matchTokenType("IDENTIFIER") || r3.matchOpToken("-");
            if (n2)
              a3 += n2.value;
          } while (n2);
          return { type: "objectKey", key: a3, evaluate: function() {
            return a3;
          } };
        }
      });
      t2.addLeafExpression("objectLiteral", function(e2, t3, r3) {
        if (!r3.matchOpToken("{"))
          return;
        var n2 = [];
        var i2 = [];
        if (!r3.matchOpToken("}")) {
          do {
            var a3 = e2.requireElement("objectKey", r3);
            r3.requireOpToken(":");
            var o2 = e2.requireElement("expression", r3);
            i2.push(o2);
            n2.push(a3);
          } while (r3.matchOpToken(",") && !r3.peekToken("}", 0, "R_BRACE"));
          r3.requireOpToken("}");
        }
        return { type: "objectLiteral", args: [n2, i2], op: function(e3, t4, r4) {
          var n3 = {};
          for (var i3 = 0;i3 < t4.length; i3++) {
            n3[t4[i3]] = r4[i3];
          }
          return n3;
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
      });
      t2.addGrammarElement("nakedNamedArgumentList", function(e2, t3, r3) {
        var n2 = [];
        var i2 = [];
        if (r3.currentToken().type === "IDENTIFIER") {
          do {
            var a3 = r3.requireTokenType("IDENTIFIER");
            r3.requireOpToken(":");
            var o2 = e2.requireElement("expression", r3);
            i2.push(o2);
            n2.push({ name: a3, value: o2 });
          } while (r3.matchOpToken(","));
        }
        return { type: "namedArgumentList", fields: n2, args: [i2], op: function(e3, t4) {
          var r4 = { _namedArgList_: true };
          for (var i3 = 0;i3 < t4.length; i3++) {
            var a4 = n2[i3];
            r4[a4.name.value] = t4[i3];
          }
          return r4;
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
      });
      t2.addGrammarElement("namedArgumentList", function(e2, t3, r3) {
        if (!r3.matchOpToken("("))
          return;
        var n2 = e2.requireElement("nakedNamedArgumentList", r3);
        r3.requireOpToken(")");
        return n2;
      });
      t2.addGrammarElement("symbol", function(e2, t3, r3) {
        var n2 = "default";
        if (r3.matchToken("global")) {
          n2 = "global";
        } else if (r3.matchToken("element") || r3.matchToken("module")) {
          n2 = "element";
          if (r3.matchOpToken("'")) {
            r3.requireToken("s");
          }
        } else if (r3.matchToken("local")) {
          n2 = "local";
        }
        let i2 = r3.matchOpToken(":");
        let a3 = r3.matchTokenType("IDENTIFIER");
        if (a3 && a3.value) {
          var o2 = a3.value;
          if (i2) {
            o2 = ":" + o2;
          }
          if (n2 === "default") {
            if (o2.indexOf("$") === 0) {
              n2 = "global";
            }
            if (o2.indexOf(":") === 0) {
              n2 = "element";
            }
          }
          return { type: "symbol", token: a3, scope: n2, name: o2, evaluate: function(e3) {
            return t3.resolveSymbol(o2, e3, n2);
          } };
        }
      });
      t2.addGrammarElement("implicitMeTarget", function(e2, t3, r3) {
        return { type: "implicitMeTarget", evaluate: function(e3) {
          return e3.you || e3.me;
        } };
      });
      t2.addLeafExpression("boolean", function(e2, t3, r3) {
        var n2 = r3.matchToken("true") || r3.matchToken("false");
        if (!n2)
          return;
        const i2 = n2.value === "true";
        return { type: "boolean", evaluate: function(e3) {
          return i2;
        } };
      });
      t2.addLeafExpression("null", function(e2, t3, r3) {
        if (r3.matchToken("null")) {
          return { type: "null", evaluate: function(e3) {
            return null;
          } };
        }
      });
      t2.addLeafExpression("arrayLiteral", function(e2, t3, r3) {
        if (!r3.matchOpToken("["))
          return;
        var n2 = [];
        if (!r3.matchOpToken("]")) {
          do {
            var i2 = e2.requireElement("expression", r3);
            n2.push(i2);
          } while (r3.matchOpToken(","));
          r3.requireOpToken("]");
        }
        return { type: "arrayLiteral", values: n2, args: [n2], op: function(e3, t4) {
          return t4;
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
      });
      t2.addLeafExpression("blockLiteral", function(e2, t3, r3) {
        if (!r3.matchOpToken("\\"))
          return;
        var n2 = [];
        var i2 = r3.matchTokenType("IDENTIFIER");
        if (i2) {
          n2.push(i2);
          while (r3.matchOpToken(",")) {
            n2.push(r3.requireTokenType("IDENTIFIER"));
          }
        }
        r3.requireOpToken("-");
        r3.requireOpToken(">");
        var a3 = e2.requireElement("expression", r3);
        return { type: "blockLiteral", args: n2, expr: a3, evaluate: function(e3) {
          var t4 = function() {
            for (var t5 = 0;t5 < n2.length; t5++) {
              e3.locals[n2[t5].value] = arguments[t5];
            }
            return a3.evaluate(e3);
          };
          return t4;
        } };
      });
      t2.addIndirectExpression("propertyAccess", function(e2, t3, r3, n2) {
        if (!r3.matchOpToken("."))
          return;
        var i2 = r3.requireTokenType("IDENTIFIER");
        var a3 = { type: "propertyAccess", root: n2, prop: i2, args: [n2], op: function(e3, r4) {
          var n3 = t3.resolveProperty(r4, i2.value);
          return n3;
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
        return e2.parseElement("indirectExpression", r3, a3);
      });
      t2.addIndirectExpression("of", function(e2, t3, r3, n2) {
        if (!r3.matchToken("of"))
          return;
        var i2 = e2.requireElement("unaryExpression", r3);
        var a3 = null;
        var o2 = n2;
        while (o2.root) {
          a3 = o2;
          o2 = o2.root;
        }
        if (o2.type !== "symbol" && o2.type !== "attributeRef" && o2.type !== "styleRef" && o2.type !== "computedStyleRef") {
          e2.raiseParseError(r3, "Cannot take a property of a non-symbol: " + o2.type);
        }
        var s3 = o2.type === "attributeRef";
        var u3 = o2.type === "styleRef" || o2.type === "computedStyleRef";
        if (s3 || u3) {
          var l3 = o2;
        }
        var c3 = o2.name;
        var f3 = { type: "ofExpression", prop: o2.token, root: i2, attribute: l3, expression: n2, args: [i2], op: function(e3, r4) {
          if (s3) {
            return t3.resolveAttribute(r4, c3);
          } else if (u3) {
            if (o2.type === "computedStyleRef") {
              return t3.resolveComputedStyle(r4, c3);
            } else {
              return t3.resolveStyle(r4, c3);
            }
          } else {
            return t3.resolveProperty(r4, c3);
          }
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
        if (o2.type === "attributeRef") {
          f3.attribute = o2;
        }
        if (a3) {
          a3.root = f3;
          a3.args = [f3];
        } else {
          n2 = f3;
        }
        return e2.parseElement("indirectExpression", r3, n2);
      });
      t2.addIndirectExpression("possessive", function(e2, t3, r3, n2) {
        if (e2.possessivesDisabled) {
          return;
        }
        var i2 = r3.matchOpToken("'");
        if (i2 || n2.type === "symbol" && (n2.name === "my" || n2.name === "its" || n2.name === "your") && (r3.currentToken().type === "IDENTIFIER" || r3.currentToken().type === "ATTRIBUTE_REF" || r3.currentToken().type === "STYLE_REF")) {
          if (i2) {
            r3.requireToken("s");
          }
          var a3, o2, s3;
          a3 = e2.parseElement("attributeRef", r3);
          if (a3 == null) {
            o2 = e2.parseElement("styleRef", r3);
            if (o2 == null) {
              s3 = r3.requireTokenType("IDENTIFIER");
            }
          }
          var u3 = { type: "possessive", root: n2, attribute: a3 || o2, prop: s3, args: [n2], op: function(e3, r4) {
            if (a3) {
              var n3 = t3.resolveAttribute(r4, a3.name);
            } else if (o2) {
              var n3;
              if (o2.type === "computedStyleRef") {
                n3 = t3.resolveComputedStyle(r4, o2["name"]);
              } else {
                n3 = t3.resolveStyle(r4, o2["name"]);
              }
            } else {
              var n3 = t3.resolveProperty(r4, s3.value);
            }
            return n3;
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
          return e2.parseElement("indirectExpression", r3, u3);
        }
      });
      t2.addIndirectExpression("inExpression", function(e2, t3, r3, n2) {
        if (!r3.matchToken("in"))
          return;
        var i2 = e2.requireElement("unaryExpression", r3);
        var a3 = { type: "inExpression", root: n2, args: [n2, i2], op: function(e3, r4, n3) {
          var i3 = [];
          if (r4.css) {
            t3.implicitLoop(n3, function(e4) {
              var t4 = e4.querySelectorAll(r4.css);
              for (var n4 = 0;n4 < t4.length; n4++) {
                i3.push(t4[n4]);
              }
            });
          } else if (r4 instanceof Element) {
            var a4 = false;
            t3.implicitLoop(n3, function(e4) {
              if (e4.contains(r4)) {
                a4 = true;
              }
            });
            if (a4) {
              return r4;
            }
          } else {
            t3.implicitLoop(r4, function(e4) {
              t3.implicitLoop(n3, function(t4) {
                if (e4 === t4) {
                  i3.push(e4);
                }
              });
            });
          }
          return i3;
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
        return e2.parseElement("indirectExpression", r3, a3);
      });
      t2.addIndirectExpression("asExpression", function(e2, t3, r3, n2) {
        if (!r3.matchToken("as"))
          return;
        r3.matchToken("a") || r3.matchToken("an");
        var i2 = e2.requireElement("dotOrColonPath", r3).evaluate();
        var a3 = { type: "asExpression", root: n2, args: [n2], op: function(e3, r4) {
          return t3.convertValue(r4, i2);
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
        return e2.parseElement("indirectExpression", r3, a3);
      });
      t2.addIndirectExpression("functionCall", function(e2, t3, r3, n2) {
        if (!r3.matchOpToken("("))
          return;
        var i2 = [];
        if (!r3.matchOpToken(")")) {
          do {
            i2.push(e2.requireElement("expression", r3));
          } while (r3.matchOpToken(","));
          r3.requireOpToken(")");
        }
        if (n2.root) {
          var a3 = { type: "functionCall", root: n2, argExressions: i2, args: [n2.root, i2], op: function(e3, r4, i3) {
            t3.nullCheck(r4, n2.root);
            var a4 = r4[n2.prop.value];
            t3.nullCheck(a4, n2);
            if (a4.hyperfunc) {
              i3.push(e3);
            }
            return a4.apply(r4, i3);
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
        } else {
          var a3 = { type: "functionCall", root: n2, argExressions: i2, args: [n2, i2], op: function(e3, r4, i3) {
            t3.nullCheck(r4, n2);
            if (r4.hyperfunc) {
              i3.push(e3);
            }
            var a4 = r4.apply(null, i3);
            return a4;
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
        }
        return e2.parseElement("indirectExpression", r3, a3);
      });
      t2.addIndirectExpression("attributeRefAccess", function(e2, t3, r3, n2) {
        var i2 = e2.parseElement("attributeRef", r3);
        if (!i2)
          return;
        var a3 = { type: "attributeRefAccess", root: n2, attribute: i2, args: [n2], op: function(e3, r4) {
          var n3 = t3.resolveAttribute(r4, i2.name);
          return n3;
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
        return a3;
      });
      t2.addIndirectExpression("arrayIndex", function(e2, t3, r3, n2) {
        if (!r3.matchOpToken("["))
          return;
        var i2 = false;
        var a3 = false;
        var o2 = null;
        var s3 = null;
        if (r3.matchOpToken("..")) {
          i2 = true;
          o2 = e2.requireElement("expression", r3);
        } else {
          o2 = e2.requireElement("expression", r3);
          if (r3.matchOpToken("..")) {
            a3 = true;
            var u3 = r3.currentToken();
            if (u3.type !== "R_BRACKET") {
              s3 = e2.parseElement("expression", r3);
            }
          }
        }
        r3.requireOpToken("]");
        var l3 = { type: "arrayIndex", root: n2, prop: o2, firstIndex: o2, secondIndex: s3, args: [n2, o2, s3], op: function(e3, t4, r4, n3) {
          if (t4 == null) {
            return null;
          }
          if (i2) {
            if (r4 < 0) {
              r4 = t4.length + r4;
            }
            return t4.slice(0, r4 + 1);
          } else if (a3) {
            if (n3 != null) {
              if (n3 < 0) {
                n3 = t4.length + n3;
              }
              return t4.slice(r4, n3 + 1);
            } else {
              return t4.slice(r4);
            }
          } else {
            return t4[r4];
          }
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
        return e2.parseElement("indirectExpression", r3, l3);
      });
      var a2 = ["em", "ex", "cap", "ch", "ic", "rem", "lh", "rlh", "vw", "vh", "vi", "vb", "vmin", "vmax", "cm", "mm", "Q", "pc", "pt", "px"];
      t2.addGrammarElement("postfixExpression", function(e2, t3, r3) {
        var n2 = e2.parseElement("negativeNumber", r3);
        let i2 = r3.matchAnyToken.apply(r3, a2) || r3.matchOpToken("%");
        if (i2) {
          return { type: "stringPostfix", postfix: i2.value, args: [n2], op: function(e3, t4) {
            return "" + t4 + i2.value;
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
        }
        var o2 = null;
        if (r3.matchToken("s") || r3.matchToken("seconds")) {
          o2 = 1000;
        } else if (r3.matchToken("ms") || r3.matchToken("milliseconds")) {
          o2 = 1;
        }
        if (o2) {
          return { type: "timeExpression", time: n2, factor: o2, args: [n2], op: function(e3, t4) {
            return t4 * o2;
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
        }
        if (r3.matchOpToken(":")) {
          var s3 = r3.requireTokenType("IDENTIFIER");
          if (!s3.value)
            return;
          var u3 = !r3.matchOpToken("!");
          return { type: "typeCheck", typeName: s3, nullOk: u3, args: [n2], op: function(e3, r4) {
            var n3 = t3.typeCheck(r4, this.typeName.value, u3);
            if (n3) {
              return r4;
            } else {
              throw new Error("Typecheck failed!  Expected: " + s3.value);
            }
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
        } else {
          return n2;
        }
      });
      t2.addGrammarElement("logicalNot", function(e2, t3, r3) {
        if (!r3.matchToken("not"))
          return;
        var n2 = e2.requireElement("unaryExpression", r3);
        return { type: "logicalNot", root: n2, args: [n2], op: function(e3, t4) {
          return !t4;
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
      });
      t2.addGrammarElement("noExpression", function(e2, t3, r3) {
        if (!r3.matchToken("no"))
          return;
        var n2 = e2.requireElement("unaryExpression", r3);
        return { type: "noExpression", root: n2, args: [n2], op: function(e3, r4) {
          return t3.isEmpty(r4);
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
      });
      t2.addLeafExpression("some", function(e2, t3, r3) {
        if (!r3.matchToken("some"))
          return;
        var n2 = e2.requireElement("expression", r3);
        return { type: "noExpression", root: n2, args: [n2], op: function(e3, r4) {
          return !t3.isEmpty(r4);
        }, evaluate(e3) {
          return t3.unifiedEval(this, e3);
        } };
      });
      t2.addGrammarElement("negativeNumber", function(e2, t3, r3) {
        if (r3.matchOpToken("-")) {
          var n2 = e2.requireElement("negativeNumber", r3);
          return { type: "negativeNumber", root: n2, args: [n2], op: function(e3, t4) {
            return -1 * t4;
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
        } else {
          return e2.requireElement("primaryExpression", r3);
        }
      });
      t2.addGrammarElement("unaryExpression", function(e2, t3, r3) {
        r3.matchToken("the");
        return e2.parseAnyOf(["beepExpression", "logicalNot", "relativePositionalExpression", "positionalExpression", "noExpression", "postfixExpression"], r3);
      });
      t2.addGrammarElement("beepExpression", function(e2, t3, r3) {
        if (!r3.matchToken("beep!"))
          return;
        var n2 = e2.parseElement("unaryExpression", r3);
        if (n2) {
          n2["booped"] = true;
          var i2 = n2.evaluate;
          n2.evaluate = function(e3) {
            let r4 = i2.apply(n2, arguments);
            let a3 = e3.me;
            t3.beepValueToConsole(a3, n2, r4);
            return r4;
          };
          return n2;
        }
      });
      var s2 = function(e2, t3, r3, n2) {
        var i2 = t3.querySelectorAll(r3);
        for (var a3 = 0;a3 < i2.length; a3++) {
          var o2 = i2[a3];
          if (o2.compareDocumentPosition(e2) === Node.DOCUMENT_POSITION_PRECEDING) {
            return o2;
          }
        }
        if (n2) {
          return i2[0];
        }
      };
      var u2 = function(e2, t3, r3, n2) {
        var i2 = t3.querySelectorAll(r3);
        for (var a3 = i2.length - 1;a3 >= 0; a3--) {
          var o2 = i2[a3];
          if (o2.compareDocumentPosition(e2) === Node.DOCUMENT_POSITION_FOLLOWING) {
            return o2;
          }
        }
        if (n2) {
          return i2[i2.length - 1];
        }
      };
      var l2 = function(e2, t3, r3, n2) {
        var i2 = [];
        o.prototype.forEach(t3, function(t4) {
          if (t4.matches(r3) || t4 === e2) {
            i2.push(t4);
          }
        });
        for (var a3 = 0;a3 < i2.length - 1; a3++) {
          var s3 = i2[a3];
          if (s3 === e2) {
            return i2[a3 + 1];
          }
        }
        if (n2) {
          var u3 = i2[0];
          if (u3 && u3.matches(r3)) {
            return u3;
          }
        }
      };
      var c2 = function(e2, t3, r3, n2) {
        return l2(e2, Array.from(t3).reverse(), r3, n2);
      };
      t2.addGrammarElement("relativePositionalExpression", function(e2, t3, r3) {
        var n2 = r3.matchAnyToken("next", "previous");
        if (!n2)
          return;
        var a3 = n2.value === "next";
        var o2 = e2.parseElement("expression", r3);
        if (r3.matchToken("from")) {
          r3.pushFollow("in");
          try {
            var f3 = e2.requireElement("unaryExpression", r3);
          } finally {
            r3.popFollow();
          }
        } else {
          var f3 = e2.requireElement("implicitMeTarget", r3);
        }
        var m2 = false;
        var p3;
        if (r3.matchToken("in")) {
          m2 = true;
          var h2 = e2.requireElement("unaryExpression", r3);
        } else if (r3.matchToken("within")) {
          p3 = e2.requireElement("unaryExpression", r3);
        } else {
          p3 = document.body;
        }
        var v3 = false;
        if (r3.matchToken("with")) {
          r3.requireToken("wrapping");
          v3 = true;
        }
        return { type: "relativePositionalExpression", from: f3, forwardSearch: a3, inSearch: m2, wrapping: v3, inElt: h2, withinElt: p3, operator: n2.value, args: [o2, f3, h2, p3], op: function(e3, t4, r4, n3, f4) {
          var p4 = t4.css;
          if (p4 == null) {
            throw "Expected a CSS value to be returned by " + i.sourceFor.apply(o2);
          }
          if (m2) {
            if (n3) {
              if (a3) {
                return l2(r4, n3, p4, v3);
              } else {
                return c2(r4, n3, p4, v3);
              }
            }
          } else {
            if (f4) {
              if (a3) {
                return s2(r4, f4, p4, v3);
              } else {
                return u2(r4, f4, p4, v3);
              }
            }
          }
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
      });
      t2.addGrammarElement("positionalExpression", function(e2, t3, r3) {
        var n2 = r3.matchAnyToken("first", "last", "random");
        if (!n2)
          return;
        r3.matchAnyToken("in", "from", "of");
        var i2 = e2.requireElement("unaryExpression", r3);
        const a3 = n2.value;
        return { type: "positionalExpression", rhs: i2, operator: n2.value, args: [i2], op: function(e3, t4) {
          if (t4 && !Array.isArray(t4)) {
            if (t4.children) {
              t4 = t4.children;
            } else {
              t4 = Array.from(t4);
            }
          }
          if (t4) {
            if (a3 === "first") {
              return t4[0];
            } else if (a3 === "last") {
              return t4[t4.length - 1];
            } else if (a3 === "random") {
              return t4[Math.floor(Math.random() * t4.length)];
            }
          }
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
      });
      t2.addGrammarElement("mathOperator", function(e2, t3, r3) {
        var n2 = e2.parseElement("unaryExpression", r3);
        var i2, a3 = null;
        i2 = r3.matchAnyOpToken("+", "-", "*", "/") || r3.matchToken("mod");
        while (i2) {
          a3 = a3 || i2;
          var o2 = i2.value;
          if (a3.value !== o2) {
            e2.raiseParseError(r3, "You must parenthesize math operations with different operators");
          }
          var s3 = e2.parseElement("unaryExpression", r3);
          n2 = { type: "mathOperator", lhs: n2, rhs: s3, operator: o2, args: [n2, s3], op: function(e3, t4, r4) {
            if (o2 === "+") {
              return t4 + r4;
            } else if (o2 === "-") {
              return t4 - r4;
            } else if (o2 === "*") {
              return t4 * r4;
            } else if (o2 === "/") {
              return t4 / r4;
            } else if (o2 === "mod") {
              return t4 % r4;
            }
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
          i2 = r3.matchAnyOpToken("+", "-", "*", "/") || r3.matchToken("mod");
        }
        return n2;
      });
      t2.addGrammarElement("mathExpression", function(e2, t3, r3) {
        return e2.parseAnyOf(["mathOperator", "unaryExpression"], r3);
      });
      function f2(e2, t3, r3) {
        if (t3["contains"]) {
          return t3.contains(r3);
        } else if (t3["includes"]) {
          return t3.includes(r3);
        } else {
          throw Error("The value of " + e2.sourceFor() + " does not have a contains or includes method on it");
        }
      }
      function p2(e2, t3, r3) {
        if (t3["match"]) {
          return !!t3.match(r3);
        } else if (t3["matches"]) {
          return t3.matches(r3);
        } else {
          throw Error("The value of " + e2.sourceFor() + " does not have a match or matches method on it");
        }
      }
      t2.addGrammarElement("comparisonOperator", function(e2, t3, r3) {
        var n2 = e2.parseElement("mathExpression", r3);
        var i2 = r3.matchAnyOpToken("<", ">", "<=", ">=", "==", "===", "!=", "!==");
        var a3 = i2 ? i2.value : null;
        var o2 = true;
        var s3 = false;
        if (a3 == null) {
          if (r3.matchToken("is") || r3.matchToken("am")) {
            if (r3.matchToken("not")) {
              if (r3.matchToken("in")) {
                a3 = "not in";
              } else if (r3.matchToken("a") || r3.matchToken("an")) {
                a3 = "not a";
                s3 = true;
              } else if (r3.matchToken("empty")) {
                a3 = "not empty";
                o2 = false;
              } else {
                if (r3.matchToken("really")) {
                  a3 = "!==";
                } else {
                  a3 = "!=";
                }
                if (r3.matchToken("equal")) {
                  r3.matchToken("to");
                }
              }
            } else if (r3.matchToken("in")) {
              a3 = "in";
            } else if (r3.matchToken("a") || r3.matchToken("an")) {
              a3 = "a";
              s3 = true;
            } else if (r3.matchToken("empty")) {
              a3 = "empty";
              o2 = false;
            } else if (r3.matchToken("less")) {
              r3.requireToken("than");
              if (r3.matchToken("or")) {
                r3.requireToken("equal");
                r3.requireToken("to");
                a3 = "<=";
              } else {
                a3 = "<";
              }
            } else if (r3.matchToken("greater")) {
              r3.requireToken("than");
              if (r3.matchToken("or")) {
                r3.requireToken("equal");
                r3.requireToken("to");
                a3 = ">=";
              } else {
                a3 = ">";
              }
            } else {
              if (r3.matchToken("really")) {
                a3 = "===";
              } else {
                a3 = "==";
              }
              if (r3.matchToken("equal")) {
                r3.matchToken("to");
              }
            }
          } else if (r3.matchToken("equals")) {
            a3 = "==";
          } else if (r3.matchToken("really")) {
            r3.requireToken("equals");
            a3 = "===";
          } else if (r3.matchToken("exist") || r3.matchToken("exists")) {
            a3 = "exist";
            o2 = false;
          } else if (r3.matchToken("matches") || r3.matchToken("match")) {
            a3 = "match";
          } else if (r3.matchToken("contains") || r3.matchToken("contain")) {
            a3 = "contain";
          } else if (r3.matchToken("includes") || r3.matchToken("include")) {
            a3 = "include";
          } else if (r3.matchToken("do") || r3.matchToken("does")) {
            r3.requireToken("not");
            if (r3.matchToken("matches") || r3.matchToken("match")) {
              a3 = "not match";
            } else if (r3.matchToken("contains") || r3.matchToken("contain")) {
              a3 = "not contain";
            } else if (r3.matchToken("exist") || r3.matchToken("exist")) {
              a3 = "not exist";
              o2 = false;
            } else if (r3.matchToken("include")) {
              a3 = "not include";
            } else {
              e2.raiseParseError(r3, "Expected matches or contains");
            }
          }
        }
        if (a3) {
          var u3, l3, c3;
          if (s3) {
            u3 = r3.requireTokenType("IDENTIFIER");
            l3 = !r3.matchOpToken("!");
          } else if (o2) {
            c3 = e2.requireElement("mathExpression", r3);
            if (a3 === "match" || a3 === "not match") {
              c3 = c3.css ? c3.css : c3;
            }
          }
          var m2 = n2;
          n2 = { type: "comparisonOperator", operator: a3, typeName: u3, nullOk: l3, lhs: n2, rhs: c3, args: [n2, c3], op: function(e3, r4, n3) {
            if (a3 === "==") {
              return r4 == n3;
            } else if (a3 === "!=") {
              return r4 != n3;
            }
            if (a3 === "===") {
              return r4 === n3;
            } else if (a3 === "!==") {
              return r4 !== n3;
            }
            if (a3 === "match") {
              return r4 != null && p2(m2, r4, n3);
            }
            if (a3 === "not match") {
              return r4 == null || !p2(m2, r4, n3);
            }
            if (a3 === "in") {
              return n3 != null && f2(c3, n3, r4);
            }
            if (a3 === "not in") {
              return n3 == null || !f2(c3, n3, r4);
            }
            if (a3 === "contain") {
              return r4 != null && f2(m2, r4, n3);
            }
            if (a3 === "not contain") {
              return r4 == null || !f2(m2, r4, n3);
            }
            if (a3 === "include") {
              return r4 != null && f2(m2, r4, n3);
            }
            if (a3 === "not include") {
              return r4 == null || !f2(m2, r4, n3);
            }
            if (a3 === "===") {
              return r4 === n3;
            } else if (a3 === "!==") {
              return r4 !== n3;
            } else if (a3 === "<") {
              return r4 < n3;
            } else if (a3 === ">") {
              return r4 > n3;
            } else if (a3 === "<=") {
              return r4 <= n3;
            } else if (a3 === ">=") {
              return r4 >= n3;
            } else if (a3 === "empty") {
              return t3.isEmpty(r4);
            } else if (a3 === "not empty") {
              return !t3.isEmpty(r4);
            } else if (a3 === "exist") {
              return t3.doesExist(r4);
            } else if (a3 === "not exist") {
              return !t3.doesExist(r4);
            } else if (a3 === "a") {
              return t3.typeCheck(r4, u3.value, l3);
            } else if (a3 === "not a") {
              return !t3.typeCheck(r4, u3.value, l3);
            } else {
              throw "Unknown comparison : " + a3;
            }
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3);
          } };
        }
        return n2;
      });
      t2.addGrammarElement("comparisonExpression", function(e2, t3, r3) {
        return e2.parseAnyOf(["comparisonOperator", "mathExpression"], r3);
      });
      t2.addGrammarElement("logicalOperator", function(e2, t3, r3) {
        var n2 = e2.parseElement("comparisonExpression", r3);
        var i2, a3 = null;
        i2 = r3.matchToken("and") || r3.matchToken("or");
        while (i2) {
          a3 = a3 || i2;
          if (a3.value !== i2.value) {
            e2.raiseParseError(r3, "You must parenthesize logical operations with different operators");
          }
          var o2 = e2.requireElement("comparisonExpression", r3);
          const s3 = i2.value;
          n2 = { type: "logicalOperator", operator: s3, lhs: n2, rhs: o2, args: [n2, o2], op: function(e3, t4, r4) {
            if (s3 === "and") {
              return t4 && r4;
            } else {
              return t4 || r4;
            }
          }, evaluate: function(e3) {
            return t3.unifiedEval(this, e3, s3 === "or");
          } };
          i2 = r3.matchToken("and") || r3.matchToken("or");
        }
        return n2;
      });
      t2.addGrammarElement("logicalExpression", function(e2, t3, r3) {
        return e2.parseAnyOf(["logicalOperator", "mathExpression"], r3);
      });
      t2.addGrammarElement("asyncExpression", function(e2, t3, r3) {
        if (r3.matchToken("async")) {
          var n2 = e2.requireElement("logicalExpression", r3);
          var i2 = { type: "asyncExpression", value: n2, evaluate: function(e3) {
            return { asyncWrapper: true, value: this.value.evaluate(e3) };
          } };
          return i2;
        } else {
          return e2.parseElement("logicalExpression", r3);
        }
      });
      t2.addGrammarElement("expression", function(e2, t3, r3) {
        r3.matchToken("the");
        return e2.parseElement("asyncExpression", r3);
      });
      t2.addGrammarElement("assignableExpression", function(e2, t3, r3) {
        r3.matchToken("the");
        var n2 = e2.parseElement("primaryExpression", r3);
        if (n2 && (n2.type === "symbol" || n2.type === "ofExpression" || n2.type === "propertyAccess" || n2.type === "attributeRefAccess" || n2.type === "attributeRef" || n2.type === "styleRef" || n2.type === "arrayIndex" || n2.type === "possessive")) {
          return n2;
        } else {
          e2.raiseParseError(r3, "A target expression must be writable.  The expression type '" + (n2 && n2.type) + "' is not.");
        }
        return n2;
      });
      t2.addGrammarElement("hyperscript", function(e2, t3, r3) {
        var n2 = [];
        if (r3.hasMore()) {
          while (e2.featureStart(r3.currentToken()) || r3.currentToken().value === "(") {
            var i2 = e2.requireElement("feature", r3);
            n2.push(i2);
            r3.matchToken("end");
          }
        }
        return { type: "hyperscript", features: n2, apply: function(e3, t4, r4) {
          for (const i3 of n2) {
            i3.install(e3, t4, r4);
          }
        } };
      });
      var v2 = function(e2) {
        var t3 = [];
        if (e2.token(0).value === "(" && (e2.token(1).value === ")" || e2.token(2).value === "," || e2.token(2).value === ")")) {
          e2.matchOpToken("(");
          do {
            t3.push(e2.requireTokenType("IDENTIFIER"));
          } while (e2.matchOpToken(","));
          e2.requireOpToken(")");
        }
        return t3;
      };
      t2.addFeature("on", function(e2, t3, r3) {
        if (!r3.matchToken("on"))
          return;
        var n2 = false;
        if (r3.matchToken("every")) {
          n2 = true;
        }
        var i2 = [];
        var a3 = null;
        do {
          var o2 = e2.requireElement("eventName", r3, "Expected event name");
          var s3 = o2.evaluate();
          if (a3) {
            a3 = a3 + " or " + s3;
          } else {
            a3 = "on " + s3;
          }
          var u3 = v2(r3);
          var l3 = null;
          if (r3.matchOpToken("[")) {
            l3 = e2.requireElement("expression", r3);
            r3.requireOpToken("]");
          }
          var c3, f3, m2;
          if (r3.currentToken().type === "NUMBER") {
            var p3 = r3.consumeToken();
            if (!p3.value)
              return;
            c3 = parseInt(p3.value);
            if (r3.matchToken("to")) {
              var h2 = r3.consumeToken();
              if (!h2.value)
                return;
              f3 = parseInt(h2.value);
            } else if (r3.matchToken("and")) {
              m2 = true;
              r3.requireToken("on");
            }
          }
          var d3, E2;
          if (s3 === "intersection") {
            d3 = {};
            if (r3.matchToken("with")) {
              d3["with"] = e2.requireElement("expression", r3).evaluate();
            }
            if (r3.matchToken("having")) {
              do {
                if (r3.matchToken("margin")) {
                  d3["rootMargin"] = e2.requireElement("stringLike", r3).evaluate();
                } else if (r3.matchToken("threshold")) {
                  d3["threshold"] = e2.requireElement("expression", r3).evaluate();
                } else {
                  e2.raiseParseError(r3, "Unknown intersection config specification");
                }
              } while (r3.matchToken("and"));
            }
          } else if (s3 === "mutation") {
            E2 = {};
            if (r3.matchToken("of")) {
              do {
                if (r3.matchToken("anything")) {
                  E2["attributes"] = true;
                  E2["subtree"] = true;
                  E2["characterData"] = true;
                  E2["childList"] = true;
                } else if (r3.matchToken("childList")) {
                  E2["childList"] = true;
                } else if (r3.matchToken("attributes")) {
                  E2["attributes"] = true;
                  E2["attributeOldValue"] = true;
                } else if (r3.matchToken("subtree")) {
                  E2["subtree"] = true;
                } else if (r3.matchToken("characterData")) {
                  E2["characterData"] = true;
                  E2["characterDataOldValue"] = true;
                } else if (r3.currentToken().type === "ATTRIBUTE_REF") {
                  var T3 = r3.consumeToken();
                  if (E2["attributeFilter"] == null) {
                    E2["attributeFilter"] = [];
                  }
                  if (T3.value.indexOf("@") == 0) {
                    E2["attributeFilter"].push(T3.value.substring(1));
                  } else {
                    e2.raiseParseError(r3, "Only shorthand attribute references are allowed here");
                  }
                } else {
                  e2.raiseParseError(r3, "Unknown mutation config specification");
                }
              } while (r3.matchToken("or"));
            } else {
              E2["attributes"] = true;
              E2["characterData"] = true;
              E2["childList"] = true;
            }
          }
          var y3 = null;
          var k3 = false;
          if (r3.matchToken("from")) {
            if (r3.matchToken("elsewhere")) {
              k3 = true;
            } else {
              r3.pushFollow("or");
              try {
                y3 = e2.requireElement("expression", r3);
              } finally {
                r3.popFollow();
              }
              if (!y3) {
                e2.raiseParseError(r3, 'Expected either target value or "elsewhere".');
              }
            }
          }
          if (y3 === null && k3 === false && r3.matchToken("elsewhere")) {
            k3 = true;
          }
          if (r3.matchToken("in")) {
            var x3 = e2.parseElement("unaryExpression", r3);
          }
          if (r3.matchToken("debounced")) {
            r3.requireToken("at");
            var g3 = e2.requireElement("unaryExpression", r3);
            var b3 = g3.evaluate({});
          } else if (r3.matchToken("throttled")) {
            r3.requireToken("at");
            var g3 = e2.requireElement("unaryExpression", r3);
            var w3 = g3.evaluate({});
          }
          i2.push({ execCount: 0, every: n2, on: s3, args: u3, filter: l3, from: y3, inExpr: x3, elsewhere: k3, startCount: c3, endCount: f3, unbounded: m2, debounceTime: b3, throttleTime: w3, mutationSpec: E2, intersectionSpec: d3, debounced: undefined, lastExec: undefined });
        } while (r3.matchToken("or"));
        var S3 = true;
        if (!n2) {
          if (r3.matchToken("queue")) {
            if (r3.matchToken("all")) {
              var N = true;
              var S3 = false;
            } else if (r3.matchToken("first")) {
              var q = true;
            } else if (r3.matchToken("none")) {
              var I = true;
            } else {
              r3.requireToken("last");
            }
          }
        }
        var C = e2.requireElement("commandList", r3);
        e2.ensureTerminated(C);
        var R, A;
        if (r3.matchToken("catch")) {
          R = r3.requireTokenType("IDENTIFIER").value;
          A = e2.requireElement("commandList", r3);
          e2.ensureTerminated(A);
        }
        if (r3.matchToken("finally")) {
          var L = e2.requireElement("commandList", r3);
          e2.ensureTerminated(L);
        }
        var O = { displayName: a3, events: i2, start: C, every: n2, execCount: 0, errorHandler: A, errorSymbol: R, execute: function(e3) {
          let r4 = t3.getEventQueueFor(e3.me, O);
          if (r4.executing && n2 === false) {
            if (I || q && r4.queue.length > 0) {
              return;
            }
            if (S3) {
              r4.queue.length = 0;
            }
            r4.queue.push(e3);
            return;
          }
          O.execCount++;
          r4.executing = true;
          e3.meta.onHalt = function() {
            r4.executing = false;
            var e4 = r4.queue.shift();
            if (e4) {
              setTimeout(function() {
                O.execute(e4);
              }, 1);
            }
          };
          e3.meta.reject = function(r5) {
            console.error(r5.message ? r5.message : r5);
            var n3 = t3.getHyperTrace(e3, r5);
            if (n3) {
              n3.print();
            }
            t3.triggerEvent(e3.me, "exception", { error: r5 });
          };
          C.execute(e3);
        }, install: function(e3, r4) {
          for (const r5 of O.events) {
            var n3;
            if (r5.elsewhere) {
              n3 = [document];
            } else if (r5.from) {
              n3 = r5.from.evaluate(t3.makeContext(e3, O, e3, null));
            } else {
              n3 = [e3];
            }
            t3.implicitLoop(n3, function(n4) {
              var i3 = r5.on;
              if (n4 == null) {
                console.warn("'%s' feature ignored because target does not exists:", a3, e3);
                return;
              }
              if (r5.mutationSpec) {
                i3 = "hyperscript:mutation";
                const e4 = new MutationObserver(function(e5, r6) {
                  if (!O.executing) {
                    t3.triggerEvent(n4, i3, { mutationList: e5, observer: r6 });
                  }
                });
                e4.observe(n4, r5.mutationSpec);
              }
              if (r5.intersectionSpec) {
                i3 = "hyperscript:intersection";
                const e4 = new IntersectionObserver(function(r6) {
                  for (const o4 of r6) {
                    var a4 = { observer: e4 };
                    a4 = Object.assign(a4, o4);
                    a4["intersecting"] = o4.isIntersecting;
                    t3.triggerEvent(n4, i3, a4);
                  }
                }, r5.intersectionSpec);
                e4.observe(n4);
              }
              var o3 = n4.addEventListener || n4.on;
              o3.call(n4, i3, function a(o4) {
                if (typeof Node !== "undefined" && e3 instanceof Node && n4 !== e3 && !e3.isConnected) {
                  n4.removeEventListener(i3, a);
                  return;
                }
                var s4 = t3.makeContext(e3, O, e3, o4);
                if (r5.elsewhere && e3.contains(o4.target)) {
                  return;
                }
                if (r5.from) {
                  s4.result = n4;
                }
                for (const e4 of r5.args) {
                  let t4 = s4.event[e4.value];
                  if (t4 !== undefined) {
                    s4.locals[e4.value] = t4;
                  } else if ("detail" in s4.event) {
                    s4.locals[e4.value] = s4.event["detail"][e4.value];
                  }
                }
                s4.meta.errorHandler = A;
                s4.meta.errorSymbol = R;
                s4.meta.finallyHandler = L;
                if (r5.filter) {
                  var u4 = s4.meta.context;
                  s4.meta.context = s4.event;
                  try {
                    var l4 = r5.filter.evaluate(s4);
                    if (l4) {} else {
                      return;
                    }
                  } finally {
                    s4.meta.context = u4;
                  }
                }
                if (r5.inExpr) {
                  var c4 = o4.target;
                  while (true) {
                    if (c4.matches && c4.matches(r5.inExpr.css)) {
                      s4.result = c4;
                      break;
                    } else {
                      c4 = c4.parentElement;
                      if (c4 == null) {
                        return;
                      }
                    }
                  }
                }
                r5.execCount++;
                if (r5.startCount) {
                  if (r5.endCount) {
                    if (r5.execCount < r5.startCount || r5.execCount > r5.endCount) {
                      return;
                    }
                  } else if (r5.unbounded) {
                    if (r5.execCount < r5.startCount) {
                      return;
                    }
                  } else if (r5.execCount !== r5.startCount) {
                    return;
                  }
                }
                if (r5.debounceTime) {
                  if (r5.debounced) {
                    clearTimeout(r5.debounced);
                  }
                  r5.debounced = setTimeout(function() {
                    O.execute(s4);
                  }, r5.debounceTime);
                  return;
                }
                if (r5.throttleTime) {
                  if (r5.lastExec && Date.now() < r5.lastExec + r5.throttleTime) {
                    return;
                  } else {
                    r5.lastExec = Date.now();
                  }
                }
                O.execute(s4);
              });
            });
          }
        } };
        e2.setParent(C, O);
        return O;
      });
      t2.addFeature("def", function(e2, t3, r3) {
        if (!r3.matchToken("def"))
          return;
        var n2 = e2.requireElement("dotOrColonPath", r3);
        var i2 = n2.evaluate();
        var a3 = i2.split(".");
        var o2 = a3.pop();
        var s3 = [];
        if (r3.matchOpToken("(")) {
          if (r3.matchOpToken(")")) {} else {
            do {
              s3.push(r3.requireTokenType("IDENTIFIER"));
            } while (r3.matchOpToken(","));
            r3.requireOpToken(")");
          }
        }
        var u3 = e2.requireElement("commandList", r3);
        var l3, c3;
        if (r3.matchToken("catch")) {
          l3 = r3.requireTokenType("IDENTIFIER").value;
          c3 = e2.parseElement("commandList", r3);
        }
        if (r3.matchToken("finally")) {
          var f3 = e2.requireElement("commandList", r3);
          e2.ensureTerminated(f3);
        }
        var m2 = { displayName: o2 + "(" + s3.map(function(e3) {
          return e3.value;
        }).join(", ") + ")", name: o2, args: s3, start: u3, errorHandler: c3, errorSymbol: l3, finallyHandler: f3, install: function(e3, r4) {
          var n3 = function() {
            var n4 = t3.makeContext(r4, m2, e3, null);
            n4.meta.errorHandler = c3;
            n4.meta.errorSymbol = l3;
            n4.meta.finallyHandler = f3;
            for (var i3 = 0;i3 < s3.length; i3++) {
              var a4 = s3[i3];
              var o3 = arguments[i3];
              if (a4) {
                n4.locals[a4.value] = o3;
              }
            }
            n4.meta.caller = arguments[s3.length];
            if (n4.meta.caller) {
              n4.meta.callingCommand = n4.meta.caller.meta.command;
            }
            var p3, h2 = null;
            var v3 = new Promise(function(e4, t4) {
              p3 = e4;
              h2 = t4;
            });
            u3.execute(n4);
            if (n4.meta.returned) {
              return n4.meta.returnValue;
            } else {
              n4.meta.resolve = p3;
              n4.meta.reject = h2;
              return v3;
            }
          };
          n3.hyperfunc = true;
          n3.hypername = i2;
          t3.assignToNamespace(e3, a3, o2, n3);
        } };
        e2.ensureTerminated(u3);
        if (c3) {
          e2.ensureTerminated(c3);
        }
        e2.setParent(u3, m2);
        return m2;
      });
      t2.addFeature("set", function(e2, t3, r3) {
        let n2 = e2.parseElement("setCommand", r3);
        if (n2) {
          if (n2.target.scope !== "element") {
            e2.raiseParseError(r3, "variables declared at the feature level must be element scoped.");
          }
          let i2 = { start: n2, install: function(e3, r4) {
            n2 && n2.execute(t3.makeContext(e3, i2, e3, null));
          } };
          e2.ensureTerminated(n2);
          return i2;
        }
      });
      t2.addFeature("init", function(e2, t3, r3) {
        if (!r3.matchToken("init"))
          return;
        var n2 = r3.matchToken("immediately");
        var i2 = e2.requireElement("commandList", r3);
        var a3 = { start: i2, install: function(e3, r4) {
          let o2 = function() {
            i2 && i2.execute(t3.makeContext(e3, a3, e3, null));
          };
          if (n2) {
            o2();
          } else {
            setTimeout(o2, 0);
          }
        } };
        e2.ensureTerminated(i2);
        e2.setParent(i2, a3);
        return a3;
      });
      t2.addFeature("worker", function(e2, t3, r3) {
        if (r3.matchToken("worker")) {
          e2.raiseParseError(r3, "In order to use the 'worker' feature, include " + "the _hyperscript worker plugin. See " + "https://hyperscript.org/features/worker/ for " + "more info.");
          return;
        }
      });
      t2.addFeature("behavior", function(t3, r3, n2) {
        if (!n2.matchToken("behavior"))
          return;
        var i2 = t3.requireElement("dotOrColonPath", n2).evaluate();
        var a3 = i2.split(".");
        var o2 = a3.pop();
        var s3 = [];
        if (n2.matchOpToken("(") && !n2.matchOpToken(")")) {
          do {
            s3.push(n2.requireTokenType("IDENTIFIER").value);
          } while (n2.matchOpToken(","));
          n2.requireOpToken(")");
        }
        var u3 = t3.requireElement("hyperscript", n2);
        for (var l3 = 0;l3 < u3.features.length; l3++) {
          var c3 = u3.features[l3];
          c3.behavior = i2;
        }
        return { install: function(t4, n3) {
          r3.assignToNamespace(e.document && e.document.body, a3, o2, function(e2, t5, n4) {
            var a4 = r3.getInternalData(e2);
            var o3 = h(a4, i2 + "Scope");
            for (var l4 = 0;l4 < s3.length; l4++) {
              o3[s3[l4]] = n4[s3[l4]];
            }
            u3.apply(e2, t5);
          });
        } };
      });
      t2.addFeature("install", function(t3, r3, n2) {
        if (!n2.matchToken("install"))
          return;
        var i2 = t3.requireElement("dotOrColonPath", n2).evaluate();
        var a3 = i2.split(".");
        var o2 = t3.parseElement("namedArgumentList", n2);
        var s3;
        return s3 = { install: function(t4, n3) {
          r3.unifiedEval({ args: [o2], op: function(r4, o3) {
            var s4 = e;
            for (var u3 = 0;u3 < a3.length; u3++) {
              s4 = s4[a3[u3]];
              if (typeof s4 !== "object" && typeof s4 !== "function")
                throw new Error("No such behavior defined as " + i2);
            }
            if (!(s4 instanceof Function))
              throw new Error(i2 + " is not a behavior");
            s4(t4, n3, o3);
          } }, r3.makeContext(t4, s3, t4, null));
        } };
      });
      t2.addGrammarElement("jsBody", function(e2, t3, r3) {
        var n2 = r3.currentToken().start;
        var i2 = r3.currentToken();
        var a3 = [];
        var o2 = "";
        var s3 = false;
        while (r3.hasMore()) {
          i2 = r3.consumeToken();
          var u3 = r3.token(0, true);
          if (u3.type === "IDENTIFIER" && u3.value === "end") {
            break;
          }
          if (s3) {
            if (i2.type === "IDENTIFIER" || i2.type === "NUMBER") {
              o2 += i2.value;
            } else {
              if (o2 !== "")
                a3.push(o2);
              o2 = "";
              s3 = false;
            }
          } else if (i2.type === "IDENTIFIER" && i2.value === "function") {
            s3 = true;
          }
        }
        var l3 = i2.end + 1;
        return { type: "jsBody", exposedFunctionNames: a3, jsSource: r3.source.substring(n2, l3) };
      });
      t2.addFeature("js", function(t3, r3, n2) {
        if (!n2.matchToken("js"))
          return;
        var i2 = t3.requireElement("jsBody", n2);
        var a3 = i2.jsSource + `
return { ` + i2.exposedFunctionNames.map(function(e2) {
          return e2 + ":" + e2;
        }).join(",") + " } ";
        var o2 = new Function(a3);
        return { jsSource: a3, function: o2, exposedFunctionNames: i2.exposedFunctionNames, install: function() {
          Object.assign(e, o2());
        } };
      });
      t2.addCommand("js", function(t3, r3, n2) {
        if (!n2.matchToken("js"))
          return;
        var i2 = [];
        if (n2.matchOpToken("(")) {
          if (n2.matchOpToken(")")) {} else {
            do {
              var a3 = n2.requireTokenType("IDENTIFIER");
              i2.push(a3.value);
            } while (n2.matchOpToken(","));
            n2.requireOpToken(")");
          }
        }
        var o2 = t3.requireElement("jsBody", n2);
        n2.matchToken("end");
        var s3 = E(Function, i2.concat([o2.jsSource]));
        var u3 = { jsSource: o2.jsSource, function: s3, inputs: i2, op: function(t4) {
          var n3 = [];
          i2.forEach(function(e2) {
            n3.push(r3.resolveSymbol(e2, t4, "default"));
          });
          var a4 = s3.apply(e, n3);
          if (a4 && typeof a4.then === "function") {
            return new Promise(function(e2) {
              a4.then(function(n4) {
                t4.result = n4;
                e2(r3.findNext(this, t4));
              });
            });
          } else {
            t4.result = a4;
            return r3.findNext(this, t4);
          }
        } };
        return u3;
      });
      t2.addCommand("async", function(e2, t3, r3) {
        if (!r3.matchToken("async"))
          return;
        if (r3.matchToken("do")) {
          var n2 = e2.requireElement("commandList", r3);
          var i2 = n2;
          while (i2.next)
            i2 = i2.next;
          i2.next = t3.HALT;
          r3.requireToken("end");
        } else {
          var n2 = e2.requireElement("command", r3);
        }
        var a3 = { body: n2, op: function(e3) {
          setTimeout(function() {
            n2.execute(e3);
          });
          return t3.findNext(this, e3);
        } };
        e2.setParent(n2, a3);
        return a3;
      });
      t2.addCommand("tell", function(e2, t3, r3) {
        var n2 = r3.currentToken();
        if (!r3.matchToken("tell"))
          return;
        var i2 = e2.requireElement("expression", r3);
        var a3 = e2.requireElement("commandList", r3);
        if (r3.hasMore() && !e2.featureStart(r3.currentToken())) {
          r3.requireToken("end");
        }
        var o2 = "tell_" + n2.start;
        var s3 = { value: i2, body: a3, args: [i2], resolveNext: function(e3) {
          var r4 = e3.meta.iterators[o2];
          if (r4.index < r4.value.length) {
            e3.you = r4.value[r4.index++];
            return a3;
          } else {
            e3.you = r4.originalYou;
            if (this.next) {
              return this.next;
            } else {
              return t3.findNext(this.parent, e3);
            }
          }
        }, op: function(e3, t4) {
          if (t4 == null) {
            t4 = [];
          } else if (!(Array.isArray(t4) || t4 instanceof NodeList)) {
            t4 = [t4];
          }
          e3.meta.iterators[o2] = { originalYou: e3.you, index: 0, value: t4 };
          return this.resolveNext(e3);
        } };
        e2.setParent(a3, s3);
        return s3;
      });
      t2.addCommand("wait", function(e2, t3, r3) {
        if (!r3.matchToken("wait"))
          return;
        var n2;
        if (r3.matchToken("for")) {
          r3.matchToken("a");
          var i2 = [];
          do {
            var a3 = r3.token(0);
            if (a3.type === "NUMBER" || a3.type === "L_PAREN") {
              i2.push({ time: e2.requireElement("expression", r3).evaluate() });
            } else {
              i2.push({ name: e2.requireElement("dotOrColonPath", r3, "Expected event name").evaluate(), args: v2(r3) });
            }
          } while (r3.matchToken("or"));
          if (r3.matchToken("from")) {
            var o2 = e2.requireElement("expression", r3);
          }
          n2 = { event: i2, on: o2, args: [o2], op: function(e3, r4) {
            var n3 = r4 ? r4 : e3.me;
            if (!(n3 instanceof EventTarget))
              throw new Error("Not a valid event target: " + this.on.sourceFor());
            return new Promise((r5) => {
              var a4 = false;
              for (const s4 of i2) {
                var o3 = (n4) => {
                  e3.result = n4;
                  if (s4.args) {
                    for (const t4 of s4.args) {
                      e3.locals[t4.value] = n4[t4.value] || (n4.detail ? n4.detail[t4.value] : null);
                    }
                  }
                  if (!a4) {
                    a4 = true;
                    r5(t3.findNext(this, e3));
                  }
                };
                if (s4.name) {
                  n3.addEventListener(s4.name, o3, { once: true });
                } else if (s4.time != null) {
                  setTimeout(o3, s4.time, s4.time);
                }
              }
            });
          } };
          return n2;
        } else {
          var s3;
          if (r3.matchToken("a")) {
            r3.requireToken("tick");
            s3 = 0;
          } else {
            s3 = e2.requireElement("expression", r3);
          }
          n2 = { type: "waitCmd", time: s3, args: [s3], op: function(e3, r4) {
            return new Promise((n3) => {
              setTimeout(() => {
                n3(t3.findNext(this, e3));
              }, r4);
            });
          }, execute: function(e3) {
            return t3.unifiedExec(this, e3);
          } };
          return n2;
        }
      });
      t2.addGrammarElement("dotOrColonPath", function(e2, t3, r3) {
        var n2 = r3.matchTokenType("IDENTIFIER");
        if (n2) {
          var i2 = [n2.value];
          var a3 = r3.matchOpToken(".") || r3.matchOpToken(":");
          if (a3) {
            do {
              i2.push(r3.requireTokenType("IDENTIFIER", "NUMBER").value);
            } while (r3.matchOpToken(a3.value));
          }
          return { type: "dotOrColonPath", path: i2, evaluate: function() {
            return i2.join(a3 ? a3.value : "");
          } };
        }
      });
      t2.addGrammarElement("eventName", function(e2, t3, r3) {
        var n2;
        if (n2 = r3.matchTokenType("STRING")) {
          return { evaluate: function() {
            return n2.value;
          } };
        }
        return e2.parseElement("dotOrColonPath", r3);
      });
      function d2(e2, t3, r3, n2) {
        var i2 = t3.requireElement("eventName", n2);
        var a3 = t3.parseElement("namedArgumentList", n2);
        if (e2 === "send" && n2.matchToken("to") || e2 === "trigger" && n2.matchToken("on")) {
          var o2 = t3.requireElement("expression", n2);
        } else {
          var o2 = t3.requireElement("implicitMeTarget", n2);
        }
        var s3 = { eventName: i2, details: a3, to: o2, args: [o2, i2, a3], op: function(e3, t4, n3, i3) {
          r3.nullCheck(t4, o2);
          r3.implicitLoop(t4, function(t5) {
            r3.triggerEvent(t5, n3, i3, e3.me);
          });
          return r3.findNext(s3, e3);
        } };
        return s3;
      }
      t2.addCommand("trigger", function(e2, t3, r3) {
        if (r3.matchToken("trigger")) {
          return d2("trigger", e2, t3, r3);
        }
      });
      t2.addCommand("send", function(e2, t3, r3) {
        if (r3.matchToken("send")) {
          return d2("send", e2, t3, r3);
        }
      });
      var T2 = function(e2, t3, r3, n2) {
        if (n2) {
          if (e2.commandBoundary(r3.currentToken())) {
            e2.raiseParseError(r3, "'return' commands must return a value.  If you do not wish to return a value, use 'exit' instead.");
          } else {
            var i2 = e2.requireElement("expression", r3);
          }
        }
        var a3 = { value: i2, args: [i2], op: function(e3, r4) {
          var n3 = e3.meta.resolve;
          e3.meta.returned = true;
          e3.meta.returnValue = r4;
          if (n3) {
            if (r4) {
              n3(r4);
            } else {
              n3();
            }
          }
          return t3.HALT;
        } };
        return a3;
      };
      t2.addCommand("return", function(e2, t3, r3) {
        if (r3.matchToken("return")) {
          return T2(e2, t3, r3, true);
        }
      });
      t2.addCommand("exit", function(e2, t3, r3) {
        if (r3.matchToken("exit")) {
          return T2(e2, t3, r3, false);
        }
      });
      t2.addCommand("halt", function(e2, t3, r3) {
        if (r3.matchToken("halt")) {
          if (r3.matchToken("the")) {
            r3.requireToken("event");
            if (r3.matchOpToken("'")) {
              r3.requireToken("s");
            }
            var n2 = true;
          }
          if (r3.matchToken("bubbling")) {
            var i2 = true;
          } else if (r3.matchToken("default")) {
            var a3 = true;
          }
          var o2 = T2(e2, t3, r3, false);
          var s3 = { keepExecuting: true, bubbling: i2, haltDefault: a3, exit: o2, op: function(e3) {
            if (e3.event) {
              if (i2) {
                e3.event.stopPropagation();
              } else if (a3) {
                e3.event.preventDefault();
              } else {
                e3.event.stopPropagation();
                e3.event.preventDefault();
              }
              if (n2) {
                return t3.findNext(this, e3);
              } else {
                return o2;
              }
            }
          } };
          return s3;
        }
      });
      t2.addCommand("log", function(e2, t3, r3) {
        if (!r3.matchToken("log"))
          return;
        var n2 = [e2.parseElement("expression", r3)];
        while (r3.matchOpToken(",")) {
          n2.push(e2.requireElement("expression", r3));
        }
        if (r3.matchToken("with")) {
          var i2 = e2.requireElement("expression", r3);
        }
        var a3 = { exprs: n2, withExpr: i2, args: [i2, n2], op: function(e3, r4, n3) {
          if (r4) {
            r4.apply(null, n3);
          } else {
            console.log.apply(null, n3);
          }
          return t3.findNext(this, e3);
        } };
        return a3;
      });
      t2.addCommand("beep!", function(e2, t3, r3) {
        if (!r3.matchToken("beep!"))
          return;
        var n2 = [e2.parseElement("expression", r3)];
        while (r3.matchOpToken(",")) {
          n2.push(e2.requireElement("expression", r3));
        }
        var i2 = { exprs: n2, args: [n2], op: function(e3, r4) {
          for (let i3 = 0;i3 < n2.length; i3++) {
            const a3 = n2[i3];
            const o2 = r4[i3];
            t3.beepValueToConsole(e3.me, a3, o2);
          }
          return t3.findNext(this, e3);
        } };
        return i2;
      });
      t2.addCommand("throw", function(e2, t3, r3) {
        if (!r3.matchToken("throw"))
          return;
        var n2 = e2.requireElement("expression", r3);
        var i2 = { expr: n2, args: [n2], op: function(e3, r4) {
          t3.registerHyperTrace(e3, r4);
          throw r4;
        } };
        return i2;
      });
      var y2 = function(e2, t3, r3) {
        var n2 = e2.requireElement("expression", r3);
        var i2 = { expr: n2, args: [n2], op: function(e3, r4) {
          e3.result = r4;
          return t3.findNext(i2, e3);
        } };
        return i2;
      };
      t2.addCommand("call", function(e2, t3, r3) {
        if (!r3.matchToken("call"))
          return;
        var n2 = y2(e2, t3, r3);
        if (n2.expr && n2.expr.type !== "functionCall") {
          e2.raiseParseError(r3, "Must be a function invocation");
        }
        return n2;
      });
      t2.addCommand("get", function(e2, t3, r3) {
        if (r3.matchToken("get")) {
          return y2(e2, t3, r3);
        }
      });
      t2.addCommand("make", function(e2, t3, r3) {
        if (!r3.matchToken("make"))
          return;
        r3.matchToken("a") || r3.matchToken("an");
        var n2 = e2.requireElement("expression", r3);
        var i2 = [];
        if (n2.type !== "queryRef" && r3.matchToken("from")) {
          do {
            i2.push(e2.requireElement("expression", r3));
          } while (r3.matchOpToken(","));
        }
        if (r3.matchToken("called")) {
          var a3 = e2.requireElement("symbol", r3);
        }
        var o2;
        if (n2.type === "queryRef") {
          o2 = { op: function(e3) {
            var r4, i3 = "div", o3, s3 = [];
            var u3 = /(?:(^|#|\.)([^#\. ]+))/g;
            while (r4 = u3.exec(n2.css)) {
              if (r4[1] === "")
                i3 = r4[2].trim();
              else if (r4[1] === "#")
                o3 = r4[2].trim();
              else
                s3.push(r4[2].trim());
            }
            var l3 = document.createElement(i3);
            if (o3 !== undefined)
              l3.id = o3;
            for (var c3 = 0;c3 < s3.length; c3++) {
              var f3 = s3[c3];
              l3.classList.add(f3);
            }
            e3.result = l3;
            if (a3) {
              t3.setSymbol(a3.name, e3, a3.scope, l3);
            }
            return t3.findNext(this, e3);
          } };
          return o2;
        } else {
          o2 = { args: [n2, i2], op: function(e3, r4, n3) {
            e3.result = E(r4, n3);
            if (a3) {
              t3.setSymbol(a3.name, e3, a3.scope, e3.result);
            }
            return t3.findNext(this, e3);
          } };
          return o2;
        }
      });
      t2.addGrammarElement("pseudoCommand", function(e2, t3, r3) {
        let n2 = r3.token(1);
        if (!(n2 && n2.op && (n2.value === "." || n2.value === "("))) {
          return null;
        }
        var i2 = e2.requireElement("primaryExpression", r3);
        var a3 = i2.root;
        var o2 = i2;
        while (a3.root != null) {
          o2 = o2.root;
          a3 = a3.root;
        }
        if (i2.type !== "functionCall") {
          e2.raiseParseError(r3, "Pseudo-commands must be function calls");
        }
        if (o2.type === "functionCall" && o2.root.root == null) {
          if (r3.matchAnyToken("the", "to", "on", "with", "into", "from", "at")) {
            var s3 = e2.requireElement("expression", r3);
          } else if (r3.matchToken("me")) {
            var s3 = e2.requireElement("implicitMeTarget", r3);
          }
        }
        var u3;
        if (s3) {
          u3 = { type: "pseudoCommand", root: s3, argExressions: o2.argExressions, args: [s3, o2.argExressions], op: function(e3, r4, n3) {
            t3.nullCheck(r4, s3);
            var i3 = r4[o2.root.name];
            t3.nullCheck(i3, o2);
            if (i3.hyperfunc) {
              n3.push(e3);
            }
            e3.result = i3.apply(r4, n3);
            return t3.findNext(u3, e3);
          }, execute: function(e3) {
            return t3.unifiedExec(this, e3);
          } };
        } else {
          u3 = { type: "pseudoCommand", expr: i2, args: [i2], op: function(e3, r4) {
            e3.result = r4;
            return t3.findNext(u3, e3);
          }, execute: function(e3) {
            return t3.unifiedExec(this, e3);
          } };
        }
        return u3;
      });
      var k2 = function(e2, t3, r3, n2, i2) {
        var a3 = n2.type === "symbol";
        var o2 = n2.type === "attributeRef";
        var s3 = n2.type === "styleRef";
        var u3 = n2.type === "arrayIndex";
        if (!(o2 || s3 || a3) && n2.root == null) {
          e2.raiseParseError(r3, "Can only put directly into symbols, not references");
        }
        var l3 = null;
        var c3 = null;
        if (a3) {} else if (o2 || s3) {
          l3 = e2.requireElement("implicitMeTarget", r3);
          var f3 = n2;
        } else if (u3) {
          c3 = n2.firstIndex;
          l3 = n2.root;
        } else {
          c3 = n2.prop ? n2.prop.value : null;
          var f3 = n2.attribute;
          l3 = n2.root;
        }
        var m2 = { target: n2, symbolWrite: a3, value: i2, args: [l3, c3, i2], op: function(e3, r4, i3, o3) {
          if (a3) {
            t3.setSymbol(n2.name, e3, n2.scope, o3);
          } else {
            t3.nullCheck(r4, l3);
            if (u3) {
              r4[i3] = o3;
            } else {
              t3.implicitLoop(r4, function(e4) {
                if (f3) {
                  if (f3.type === "attributeRef") {
                    if (o3 == null) {
                      e4.removeAttribute(f3.name);
                    } else {
                      e4.setAttribute(f3.name, o3);
                    }
                  } else {
                    e4.style[f3.name] = o3;
                  }
                } else {
                  e4[i3] = o3;
                }
              });
            }
          }
          return t3.findNext(this, e3);
        } };
        return m2;
      };
      t2.addCommand("default", function(e2, t3, r3) {
        if (!r3.matchToken("default"))
          return;
        var n2 = e2.requireElement("assignableExpression", r3);
        r3.requireToken("to");
        var i2 = e2.requireElement("expression", r3);
        var a3 = k2(e2, t3, r3, n2, i2);
        var o2 = { target: n2, value: i2, setter: a3, args: [n2], op: function(e3, r4) {
          if (r4) {
            return t3.findNext(this, e3);
          } else {
            return a3;
          }
        } };
        a3.parent = o2;
        return o2;
      });
      t2.addCommand("set", function(e2, t3, r3) {
        if (!r3.matchToken("set"))
          return;
        if (r3.currentToken().type === "L_BRACE") {
          var n2 = e2.requireElement("objectLiteral", r3);
          r3.requireToken("on");
          var i2 = e2.requireElement("expression", r3);
          var a3 = { objectLiteral: n2, target: i2, args: [n2, i2], op: function(e3, r4, n3) {
            Object.assign(n3, r4);
            return t3.findNext(this, e3);
          } };
          return a3;
        }
        try {
          r3.pushFollow("to");
          var i2 = e2.requireElement("assignableExpression", r3);
        } finally {
          r3.popFollow();
        }
        r3.requireToken("to");
        var o2 = e2.requireElement("expression", r3);
        return k2(e2, t3, r3, i2, o2);
      });
      t2.addCommand("if", function(e2, t3, r3) {
        if (!r3.matchToken("if"))
          return;
        var n2 = e2.requireElement("expression", r3);
        r3.matchToken("then");
        var i2 = e2.parseElement("commandList", r3);
        var a3 = false;
        let o2 = r3.matchToken("else") || r3.matchToken("otherwise");
        if (o2) {
          let t4 = r3.peekToken("if");
          a3 = t4 != null && t4.line === o2.line;
          if (a3) {
            var s3 = e2.parseElement("command", r3);
          } else {
            var s3 = e2.parseElement("commandList", r3);
          }
        }
        if (r3.hasMore() && !a3) {
          r3.requireToken("end");
        }
        var u3 = { expr: n2, trueBranch: i2, falseBranch: s3, args: [n2], op: function(e3, r4) {
          if (r4) {
            return i2;
          } else if (s3) {
            return s3;
          } else {
            return t3.findNext(this, e3);
          }
        } };
        e2.setParent(i2, u3);
        e2.setParent(s3, u3);
        return u3;
      });
      var x2 = function(e2, t3, r3, n2) {
        var i2 = t3.currentToken();
        var a3;
        if (t3.matchToken("for") || n2) {
          var o2 = t3.requireTokenType("IDENTIFIER");
          a3 = o2.value;
          t3.requireToken("in");
          var s3 = e2.requireElement("expression", t3);
        } else if (t3.matchToken("in")) {
          a3 = "it";
          var s3 = e2.requireElement("expression", t3);
        } else if (t3.matchToken("while")) {
          var u3 = e2.requireElement("expression", t3);
        } else if (t3.matchToken("until")) {
          var l3 = true;
          if (t3.matchToken("event")) {
            var c3 = e2.requireElement("dotOrColonPath", t3, "Expected event name");
            if (t3.matchToken("from")) {
              var f3 = e2.requireElement("expression", t3);
            }
          } else {
            var u3 = e2.requireElement("expression", t3);
          }
        } else {
          if (!e2.commandBoundary(t3.currentToken()) && t3.currentToken().value !== "forever") {
            var m2 = e2.requireElement("expression", t3);
            t3.requireToken("times");
          } else {
            t3.matchToken("forever");
            var p3 = true;
          }
        }
        if (t3.matchToken("index")) {
          var o2 = t3.requireTokenType("IDENTIFIER");
          var h2 = o2.value;
        } else if (t3.matchToken("indexed")) {
          t3.requireToken("by");
          var o2 = t3.requireTokenType("IDENTIFIER");
          var h2 = o2.value;
        }
        var v3 = e2.parseElement("commandList", t3);
        if (v3 && c3) {
          var d3 = v3;
          while (d3.next) {
            d3 = d3.next;
          }
          var E2 = { type: "waitATick", op: function() {
            return new Promise(function(e3) {
              setTimeout(function() {
                e3(r3.findNext(E2));
              }, 0);
            });
          } };
          d3.next = E2;
        }
        if (t3.hasMore()) {
          t3.requireToken("end");
        }
        if (a3 == null) {
          a3 = "_implicit_repeat_" + i2.start;
          var T3 = a3;
        } else {
          var T3 = a3 + "_" + i2.start;
        }
        var y3 = { identifier: a3, indexIdentifier: h2, slot: T3, expression: s3, forever: p3, times: m2, until: l3, event: c3, on: f3, whileExpr: u3, resolveNext: function() {
          return this;
        }, loop: v3, args: [u3, m2], op: function(e3, t4, n3) {
          var i3 = e3.meta.iterators[T3];
          var o3 = false;
          var s4 = null;
          if (this.forever) {
            o3 = true;
          } else if (this.until) {
            if (c3) {
              o3 = e3.meta.iterators[T3].eventFired === false;
            } else {
              o3 = t4 !== true;
            }
          } else if (u3) {
            o3 = t4;
          } else if (n3) {
            o3 = i3.index < n3;
          } else {
            var l4 = i3.iterator.next();
            o3 = !l4.done;
            s4 = l4.value;
          }
          if (o3) {
            if (i3.value) {
              e3.result = e3.locals[a3] = s4;
            } else {
              e3.result = i3.index;
            }
            if (h2) {
              e3.locals[h2] = i3.index;
            }
            i3.index++;
            return v3;
          } else {
            e3.meta.iterators[T3] = null;
            return r3.findNext(this.parent, e3);
          }
        } };
        e2.setParent(v3, y3);
        var k3 = { name: "repeatInit", args: [s3, c3, f3], op: function(e3, t4, r4, n3) {
          var i3 = { index: 0, value: t4, eventFired: false };
          e3.meta.iterators[T3] = i3;
          if (t4 && t4[Symbol.iterator]) {
            i3.iterator = t4[Symbol.iterator]();
          }
          if (c3) {
            var a4 = n3 || e3.me;
            a4.addEventListener(r4, function(t5) {
              e3.meta.iterators[T3].eventFired = true;
            }, { once: true });
          }
          return y3;
        }, execute: function(e3) {
          return r3.unifiedExec(this, e3);
        } };
        e2.setParent(y3, k3);
        return k3;
      };
      t2.addCommand("repeat", function(e2, t3, r3) {
        if (r3.matchToken("repeat")) {
          return x2(e2, r3, t3, false);
        }
      });
      t2.addCommand("for", function(e2, t3, r3) {
        if (r3.matchToken("for")) {
          return x2(e2, r3, t3, true);
        }
      });
      t2.addCommand("continue", function(e2, t3, r3) {
        if (!r3.matchToken("continue"))
          return;
        var n2 = { op: function(t4) {
          for (var n3 = this.parent;; n3 = n3.parent) {
            if (n3 == undefined) {
              e2.raiseParseError(r3, "Command `continue` cannot be used outside of a `repeat` loop.");
            }
            if (n3.loop != null) {
              return n3.resolveNext(t4);
            }
          }
        } };
        return n2;
      });
      t2.addCommand("break", function(e2, t3, r3) {
        if (!r3.matchToken("break"))
          return;
        var n2 = { op: function(n3) {
          for (var i2 = this.parent;; i2 = i2.parent) {
            if (i2 == undefined) {
              e2.raiseParseError(r3, "Command `continue` cannot be used outside of a `repeat` loop.");
            }
            if (i2.loop != null) {
              return t3.findNext(i2.parent, n3);
            }
          }
        } };
        return n2;
      });
      t2.addGrammarElement("stringLike", function(e2, t3, r3) {
        return e2.parseAnyOf(["string", "nakedString"], r3);
      });
      t2.addCommand("append", function(e2, t3, r3) {
        if (!r3.matchToken("append"))
          return;
        var n2 = null;
        var i2 = e2.requireElement("expression", r3);
        var a3 = { type: "symbol", evaluate: function(e3) {
          return t3.resolveSymbol("result", e3);
        } };
        if (r3.matchToken("to")) {
          n2 = e2.requireElement("expression", r3);
        } else {
          n2 = a3;
        }
        var o2 = null;
        if (n2.type === "symbol" || n2.type === "attributeRef" || n2.root != null) {
          o2 = k2(e2, t3, r3, n2, a3);
        }
        var s3 = { value: i2, target: n2, args: [n2, i2], op: function(e3, r4, n3) {
          if (Array.isArray(r4)) {
            r4.push(n3);
            return t3.findNext(this, e3);
          } else if (r4 instanceof Element) {
            if (n3 instanceof Element) {
              r4.insertAdjacentElement("beforeend", n3);
            } else {
              r4.insertAdjacentHTML("beforeend", n3);
            }
            t3.processNode(r4);
            return t3.findNext(this, e3);
          } else if (o2) {
            e3.result = (r4 || "") + n3;
            return o2;
          } else {
            throw Error("Unable to append a value!");
          }
        }, execute: function(e3) {
          return t3.unifiedExec(this, e3);
        } };
        if (o2 != null) {
          o2.parent = s3;
        }
        return s3;
      });
      function g2(e2, t3, r3) {
        r3.matchToken("at") || r3.matchToken("from");
        const n2 = { includeStart: true, includeEnd: false };
        n2.from = r3.matchToken("start") ? 0 : e2.requireElement("expression", r3);
        if (r3.matchToken("to") || r3.matchOpToken("..")) {
          if (r3.matchToken("end")) {
            n2.toEnd = true;
          } else {
            n2.to = e2.requireElement("expression", r3);
          }
        }
        if (r3.matchToken("inclusive"))
          n2.includeEnd = true;
        else if (r3.matchToken("exclusive"))
          n2.includeStart = false;
        return n2;
      }

      class b2 {
        constructor(e2, t3) {
          this.re = e2;
          this.str = t3;
        }
        next() {
          const e2 = this.re.exec(this.str);
          if (e2 === null)
            return { done: true };
          else
            return { value: e2 };
        }
      }

      class w2 {
        constructor(e2, t3, r3) {
          this.re = e2;
          this.flags = t3;
          this.str = r3;
        }
        [Symbol.iterator]() {
          return new b2(new RegExp(this.re, this.flags), this.str);
        }
      }
      t2.addCommand("pick", (e2, t3, r3) => {
        if (!r3.matchToken("pick"))
          return;
        r3.matchToken("the");
        if (r3.matchToken("item") || r3.matchToken("items") || r3.matchToken("character") || r3.matchToken("characters")) {
          const n2 = g2(e2, t3, r3);
          r3.requireToken("from");
          const i2 = e2.requireElement("expression", r3);
          return { args: [i2, n2.from, n2.to], op(e3, r4, i3, a3) {
            if (n2.toEnd)
              a3 = r4.length;
            if (!n2.includeStart)
              i3++;
            if (n2.includeEnd)
              a3++;
            if (a3 == null || a3 == undefined)
              a3 = i3 + 1;
            e3.result = r4.slice(i3, a3);
            return t3.findNext(this, e3);
          } };
        }
        if (r3.matchToken("match")) {
          r3.matchToken("of");
          const n2 = e2.parseElement("expression", r3);
          let i2 = "";
          if (r3.matchOpToken("|")) {
            i2 = r3.requireTokenType("IDENTIFIER").value;
          }
          r3.requireToken("from");
          const a3 = e2.parseElement("expression", r3);
          return { args: [a3, n2], op(e3, r4, n3) {
            e3.result = new RegExp(n3, i2).exec(r4);
            return t3.findNext(this, e3);
          } };
        }
        if (r3.matchToken("matches")) {
          r3.matchToken("of");
          const n2 = e2.parseElement("expression", r3);
          let i2 = "gu";
          if (r3.matchOpToken("|")) {
            i2 = "g" + r3.requireTokenType("IDENTIFIER").value.replace("g", "");
          }
          r3.requireToken("from");
          const a3 = e2.parseElement("expression", r3);
          return { args: [a3, n2], op(e3, r4, n3) {
            e3.result = new w2(n3, i2, r4);
            return t3.findNext(this, e3);
          } };
        }
      });
      t2.addCommand("increment", function(e2, t3, r3) {
        if (!r3.matchToken("increment"))
          return;
        var n2;
        var i2 = e2.parseElement("assignableExpression", r3);
        if (r3.matchToken("by")) {
          n2 = e2.requireElement("expression", r3);
        }
        var a3 = { type: "implicitIncrementOp", target: i2, args: [i2, n2], op: function(e3, t4, r4) {
          t4 = t4 ? parseFloat(t4) : 0;
          r4 = n2 ? parseFloat(r4) : 1;
          var i3 = t4 + r4;
          e3.result = i3;
          return i3;
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
        return k2(e2, t3, r3, i2, a3);
      });
      t2.addCommand("decrement", function(e2, t3, r3) {
        if (!r3.matchToken("decrement"))
          return;
        var n2;
        var i2 = e2.parseElement("assignableExpression", r3);
        if (r3.matchToken("by")) {
          n2 = e2.requireElement("expression", r3);
        }
        var a3 = { type: "implicitDecrementOp", target: i2, args: [i2, n2], op: function(e3, t4, r4) {
          t4 = t4 ? parseFloat(t4) : 0;
          r4 = n2 ? parseFloat(r4) : 1;
          var i3 = t4 - r4;
          e3.result = i3;
          return i3;
        }, evaluate: function(e3) {
          return t3.unifiedEval(this, e3);
        } };
        return k2(e2, t3, r3, i2, a3);
      });
      function S2(e2, t3) {
        var r3 = "text";
        var n2;
        e2.matchToken("a") || e2.matchToken("an");
        if (e2.matchToken("json") || e2.matchToken("Object")) {
          r3 = "json";
        } else if (e2.matchToken("response")) {
          r3 = "response";
        } else if (e2.matchToken("html")) {
          r3 = "html";
        } else if (e2.matchToken("text")) {} else {
          n2 = t3.requireElement("dotOrColonPath", e2).evaluate();
        }
        return { type: r3, conversion: n2 };
      }
      t2.addCommand("fetch", function(e2, t3, r3) {
        if (!r3.matchToken("fetch"))
          return;
        var n2 = e2.requireElement("stringLike", r3);
        if (r3.matchToken("as")) {
          var i2 = S2(r3, e2);
        }
        if (r3.matchToken("with") && r3.currentToken().value !== "{") {
          var a3 = e2.parseElement("nakedNamedArgumentList", r3);
        } else {
          var a3 = e2.parseElement("objectLiteral", r3);
        }
        if (i2 == null && r3.matchToken("as")) {
          i2 = S2(r3, e2);
        }
        var o2 = i2 ? i2.type : "text";
        var s3 = i2 ? i2.conversion : null;
        var u3 = { url: n2, argExpressions: a3, args: [n2, a3], op: function(e3, r4, n3) {
          var i3 = n3 || {};
          i3["sender"] = e3.me;
          i3["headers"] = i3["headers"] || {};
          var a4 = new AbortController;
          let l3 = e3.me.addEventListener("fetch:abort", function() {
            a4.abort();
          }, { once: true });
          i3["signal"] = a4.signal;
          t3.triggerEvent(e3.me, "hyperscript:beforeFetch", i3);
          t3.triggerEvent(e3.me, "fetch:beforeRequest", i3);
          n3 = i3;
          var c3 = false;
          if (n3.timeout) {
            setTimeout(function() {
              if (!c3) {
                a4.abort();
              }
            }, n3.timeout);
          }
          return fetch(r4, n3).then(function(r5) {
            let n4 = { response: r5 };
            t3.triggerEvent(e3.me, "fetch:afterResponse", n4);
            r5 = n4.response;
            if (o2 === "response") {
              e3.result = r5;
              t3.triggerEvent(e3.me, "fetch:afterRequest", { result: r5 });
              c3 = true;
              return t3.findNext(u3, e3);
            }
            if (o2 === "json") {
              return r5.json().then(function(r6) {
                e3.result = r6;
                t3.triggerEvent(e3.me, "fetch:afterRequest", { result: r6 });
                c3 = true;
                return t3.findNext(u3, e3);
              });
            }
            return r5.text().then(function(r6) {
              if (s3)
                r6 = t3.convertValue(r6, s3);
              if (o2 === "html")
                r6 = t3.convertValue(r6, "Fragment");
              e3.result = r6;
              t3.triggerEvent(e3.me, "fetch:afterRequest", { result: r6 });
              c3 = true;
              return t3.findNext(u3, e3);
            });
          }).catch(function(r5) {
            t3.triggerEvent(e3.me, "fetch:error", { reason: r5 });
            throw r5;
          }).finally(function() {
            e3.me.removeEventListener("fetch:abort", l3);
          });
        } };
        return u3;
      });
    }
    function y(e2) {
      e2.addCommand("settle", function(e3, t3, r2) {
        if (r2.matchToken("settle")) {
          if (!e3.commandBoundary(r2.currentToken())) {
            var n3 = e3.requireElement("expression", r2);
          } else {
            var n3 = e3.requireElement("implicitMeTarget", r2);
          }
          var i3 = { type: "settleCmd", args: [n3], op: function(e4, r3) {
            t3.nullCheck(r3, n3);
            var a3 = null;
            var o3 = false;
            var s2 = false;
            var u2 = new Promise(function(e5) {
              a3 = e5;
            });
            r3.addEventListener("transitionstart", function() {
              s2 = true;
            }, { once: true });
            setTimeout(function() {
              if (!s2 && !o3) {
                a3(t3.findNext(i3, e4));
              }
            }, 500);
            r3.addEventListener("transitionend", function() {
              if (!o3) {
                a3(t3.findNext(i3, e4));
              }
            }, { once: true });
            return u2;
          }, execute: function(e4) {
            return t3.unifiedExec(this, e4);
          } };
          return i3;
        }
      });
      e2.addCommand("add", function(e3, t3, r2) {
        if (r2.matchToken("add")) {
          var n3 = e3.parseElement("classRef", r2);
          var i3 = null;
          var a3 = null;
          if (n3 == null) {
            i3 = e3.parseElement("attributeRef", r2);
            if (i3 == null) {
              a3 = e3.parseElement("styleLiteral", r2);
              if (a3 == null) {
                e3.raiseParseError(r2, "Expected either a class reference or attribute expression");
              }
            }
          } else {
            var o3 = [n3];
            while (n3 = e3.parseElement("classRef", r2)) {
              o3.push(n3);
            }
          }
          if (r2.matchToken("to")) {
            var s2 = e3.requireElement("expression", r2);
          } else {
            var s2 = e3.requireElement("implicitMeTarget", r2);
          }
          if (r2.matchToken("when")) {
            if (a3) {
              e3.raiseParseError(r2, "Only class and properties are supported with a when clause");
            }
            var u2 = e3.requireElement("expression", r2);
          }
          if (o3) {
            return { classRefs: o3, to: s2, args: [s2, o3], op: function(e4, r3, n4) {
              t3.nullCheck(r3, s2);
              t3.forEach(n4, function(n5) {
                t3.implicitLoop(r3, function(r4) {
                  if (u2) {
                    e4.result = r4;
                    let i4 = t3.evaluateNoPromise(u2, e4);
                    if (i4) {
                      if (r4 instanceof Element)
                        r4.classList.add(n5.className);
                    } else {
                      if (r4 instanceof Element)
                        r4.classList.remove(n5.className);
                    }
                    e4.result = null;
                  } else {
                    if (r4 instanceof Element)
                      r4.classList.add(n5.className);
                  }
                });
              });
              return t3.findNext(this, e4);
            } };
          } else if (i3) {
            return { type: "addCmd", attributeRef: i3, to: s2, args: [s2], op: function(e4, r3, n4) {
              t3.nullCheck(r3, s2);
              t3.implicitLoop(r3, function(r4) {
                if (u2) {
                  e4.result = r4;
                  let n5 = t3.evaluateNoPromise(u2, e4);
                  if (n5) {
                    r4.setAttribute(i3.name, i3.value);
                  } else {
                    r4.removeAttribute(i3.name);
                  }
                  e4.result = null;
                } else {
                  r4.setAttribute(i3.name, i3.value);
                }
              });
              return t3.findNext(this, e4);
            }, execute: function(e4) {
              return t3.unifiedExec(this, e4);
            } };
          } else {
            return { type: "addCmd", cssDeclaration: a3, to: s2, args: [s2, a3], op: function(e4, r3, n4) {
              t3.nullCheck(r3, s2);
              t3.implicitLoop(r3, function(e5) {
                e5.style.cssText += n4;
              });
              return t3.findNext(this, e4);
            }, execute: function(e4) {
              return t3.unifiedExec(this, e4);
            } };
          }
        }
      });
      e2.addGrammarElement("styleLiteral", function(e3, t3, r2) {
        if (!r2.matchOpToken("{"))
          return;
        var n3 = [""];
        var i3 = [];
        while (r2.hasMore()) {
          if (r2.matchOpToken("\\")) {
            r2.consumeToken();
          } else if (r2.matchOpToken("}")) {
            break;
          } else if (r2.matchToken("$")) {
            var a3 = r2.matchOpToken("{");
            var o3 = e3.parseElement("expression", r2);
            if (a3)
              r2.requireOpToken("}");
            i3.push(o3);
            n3.push("");
          } else {
            var s2 = r2.consumeToken();
            n3[n3.length - 1] += r2.source.substring(s2.start, s2.end);
          }
          n3[n3.length - 1] += r2.lastWhitespace();
        }
        return { type: "styleLiteral", args: [i3], op: function(e4, t4) {
          var r3 = "";
          n3.forEach(function(e5, n4) {
            r3 += e5;
            if (n4 in t4)
              r3 += t4[n4];
          });
          return r3;
        }, evaluate: function(e4) {
          return t3.unifiedEval(this, e4);
        } };
      });
      e2.addCommand("remove", function(e3, t3, r2) {
        if (r2.matchToken("remove")) {
          var n3 = e3.parseElement("classRef", r2);
          var i3 = null;
          var a3 = null;
          if (n3 == null) {
            i3 = e3.parseElement("attributeRef", r2);
            if (i3 == null) {
              a3 = e3.parseElement("expression", r2);
              if (a3 == null) {
                e3.raiseParseError(r2, "Expected either a class reference, attribute expression or value expression");
              }
            }
          } else {
            var o3 = [n3];
            while (n3 = e3.parseElement("classRef", r2)) {
              o3.push(n3);
            }
          }
          if (r2.matchToken("from")) {
            var s2 = e3.requireElement("expression", r2);
          } else {
            if (a3 == null) {
              var s2 = e3.requireElement("implicitMeTarget", r2);
            }
          }
          if (a3) {
            return { elementExpr: a3, from: s2, args: [a3, s2], op: function(e4, r3, n4) {
              t3.nullCheck(r3, a3);
              t3.implicitLoop(r3, function(e5) {
                if (e5.parentElement && (n4 == null || n4.contains(e5))) {
                  e5.parentElement.removeChild(e5);
                }
              });
              return t3.findNext(this, e4);
            } };
          } else {
            return { classRefs: o3, attributeRef: i3, elementExpr: a3, from: s2, args: [o3, s2], op: function(e4, r3, n4) {
              t3.nullCheck(n4, s2);
              if (r3) {
                t3.forEach(r3, function(e5) {
                  t3.implicitLoop(n4, function(t4) {
                    t4.classList.remove(e5.className);
                  });
                });
              } else {
                t3.implicitLoop(n4, function(e5) {
                  e5.removeAttribute(i3.name);
                });
              }
              return t3.findNext(this, e4);
            } };
          }
        }
      });
      e2.addCommand("toggle", function(e3, t3, r2) {
        if (r2.matchToken("toggle")) {
          r2.matchAnyToken("the", "my");
          if (r2.currentToken().type === "STYLE_REF") {
            let t4 = r2.consumeToken();
            var n3 = t4.value.substr(1);
            var a3 = true;
            var o3 = i2(e3, r2, n3);
            if (r2.matchToken("of")) {
              r2.pushFollow("with");
              try {
                var s2 = e3.requireElement("expression", r2);
              } finally {
                r2.popFollow();
              }
            } else {
              var s2 = e3.requireElement("implicitMeTarget", r2);
            }
          } else if (r2.matchToken("between")) {
            var u2 = true;
            var l2 = e3.parseElement("classRef", r2);
            r2.requireToken("and");
            var c2 = e3.requireElement("classRef", r2);
          } else {
            var l2 = e3.parseElement("classRef", r2);
            var f2 = null;
            if (l2 == null) {
              f2 = e3.parseElement("attributeRef", r2);
              if (f2 == null) {
                e3.raiseParseError(r2, "Expected either a class reference or attribute expression");
              }
            } else {
              var m2 = [l2];
              while (l2 = e3.parseElement("classRef", r2)) {
                m2.push(l2);
              }
            }
          }
          if (a3 !== true) {
            if (r2.matchToken("on")) {
              var s2 = e3.requireElement("expression", r2);
            } else {
              var s2 = e3.requireElement("implicitMeTarget", r2);
            }
          }
          if (r2.matchToken("for")) {
            var p2 = e3.requireElement("expression", r2);
          } else if (r2.matchToken("until")) {
            var h2 = e3.requireElement("dotOrColonPath", r2, "Expected event name");
            if (r2.matchToken("from")) {
              var v2 = e3.requireElement("expression", r2);
            }
          }
          var d2 = { classRef: l2, classRef2: c2, classRefs: m2, attributeRef: f2, on: s2, time: p2, evt: h2, from: v2, toggle: function(e4, r3, n4, i3) {
            t3.nullCheck(e4, s2);
            if (a3) {
              t3.implicitLoop(e4, function(e5) {
                o3("toggle", e5);
              });
            } else if (u2) {
              t3.implicitLoop(e4, function(e5) {
                if (e5.classList.contains(r3.className)) {
                  e5.classList.remove(r3.className);
                  e5.classList.add(n4.className);
                } else {
                  e5.classList.add(r3.className);
                  e5.classList.remove(n4.className);
                }
              });
            } else if (i3) {
              t3.forEach(i3, function(r4) {
                t3.implicitLoop(e4, function(e5) {
                  e5.classList.toggle(r4.className);
                });
              });
            } else {
              t3.implicitLoop(e4, function(e5) {
                if (e5.hasAttribute(f2.name)) {
                  e5.removeAttribute(f2.name);
                } else {
                  e5.setAttribute(f2.name, f2.value);
                }
              });
            }
          }, args: [s2, p2, h2, v2, l2, c2, m2], op: function(e4, r3, n4, i3, a4, o4, s3, u3) {
            if (n4) {
              return new Promise(function(i4) {
                d2.toggle(r3, o4, s3, u3);
                setTimeout(function() {
                  d2.toggle(r3, o4, s3, u3);
                  i4(t3.findNext(d2, e4));
                }, n4);
              });
            } else if (i3) {
              return new Promise(function(n5) {
                var l3 = a4 || e4.me;
                l3.addEventListener(i3, function() {
                  d2.toggle(r3, o4, s3, u3);
                  n5(t3.findNext(d2, e4));
                }, { once: true });
                d2.toggle(r3, o4, s3, u3);
              });
            } else {
              this.toggle(r3, o4, s3, u3);
              return t3.findNext(d2, e4);
            }
          } };
          return d2;
        }
      });
      var t2 = { display: function(r2, n3, i3) {
        if (i3) {
          n3.style.display = i3;
        } else if (r2 === "toggle") {
          if (getComputedStyle(n3).display === "none") {
            t2.display("show", n3, i3);
          } else {
            t2.display("hide", n3, i3);
          }
        } else if (r2 === "hide") {
          const t3 = e2.runtime.getInternalData(n3);
          if (t3.originalDisplay == null) {
            t3.originalDisplay = n3.style.display;
          }
          n3.style.display = "none";
        } else {
          const t3 = e2.runtime.getInternalData(n3);
          if (t3.originalDisplay && t3.originalDisplay !== "none") {
            n3.style.display = t3.originalDisplay;
          } else {
            n3.style.removeProperty("display");
          }
        }
      }, visibility: function(e3, r2, n3) {
        if (n3) {
          r2.style.visibility = n3;
        } else if (e3 === "toggle") {
          if (getComputedStyle(r2).visibility === "hidden") {
            t2.visibility("show", r2, n3);
          } else {
            t2.visibility("hide", r2, n3);
          }
        } else if (e3 === "hide") {
          r2.style.visibility = "hidden";
        } else {
          r2.style.visibility = "visible";
        }
      }, opacity: function(e3, r2, n3) {
        if (n3) {
          r2.style.opacity = n3;
        } else if (e3 === "toggle") {
          if (getComputedStyle(r2).opacity === "0") {
            t2.opacity("show", r2, n3);
          } else {
            t2.opacity("hide", r2, n3);
          }
        } else if (e3 === "hide") {
          r2.style.opacity = "0";
        } else {
          r2.style.opacity = "1";
        }
      } };
      var n2 = function(e3, t3, r2) {
        var n3;
        var i3 = r2.currentToken();
        if (i3.value === "when" || i3.value === "with" || e3.commandBoundary(i3)) {
          n3 = e3.parseElement("implicitMeTarget", r2);
        } else {
          n3 = e3.parseElement("expression", r2);
        }
        return n3;
      };
      var i2 = function(e3, n3, i3) {
        var a3 = r.defaultHideShowStrategy;
        var o3 = t2;
        if (r.hideShowStrategies) {
          o3 = Object.assign(o3, r.hideShowStrategies);
        }
        i3 = i3 || a3 || "display";
        var s2 = o3[i3];
        if (s2 == null) {
          e3.raiseParseError(n3, "Unknown show/hide strategy : " + i3);
        }
        return s2;
      };
      e2.addCommand("hide", function(e3, t3, r2) {
        if (r2.matchToken("hide")) {
          var a3 = n2(e3, t3, r2);
          var o3 = null;
          if (r2.matchToken("with")) {
            o3 = r2.requireTokenType("IDENTIFIER", "STYLE_REF").value;
            if (o3.indexOf("*") === 0) {
              o3 = o3.substr(1);
            }
          }
          var s2 = i2(e3, r2, o3);
          return { target: a3, args: [a3], op: function(e4, r3) {
            t3.nullCheck(r3, a3);
            t3.implicitLoop(r3, function(e5) {
              s2("hide", e5);
            });
            return t3.findNext(this, e4);
          } };
        }
      });
      e2.addCommand("show", function(e3, t3, r2) {
        if (r2.matchToken("show")) {
          var a3 = n2(e3, t3, r2);
          var o3 = null;
          if (r2.matchToken("with")) {
            o3 = r2.requireTokenType("IDENTIFIER", "STYLE_REF").value;
            if (o3.indexOf("*") === 0) {
              o3 = o3.substr(1);
            }
          }
          var s2 = null;
          if (r2.matchOpToken(":")) {
            var u2 = r2.consumeUntilWhitespace();
            r2.matchTokenType("WHITESPACE");
            s2 = u2.map(function(e4) {
              return e4.value;
            }).join("");
          }
          if (r2.matchToken("when")) {
            var l2 = e3.requireElement("expression", r2);
          }
          var c2 = i2(e3, r2, o3);
          return { target: a3, when: l2, args: [a3], op: function(e4, r3) {
            t3.nullCheck(r3, a3);
            t3.implicitLoop(r3, function(r4) {
              if (l2) {
                e4.result = r4;
                let n3 = t3.evaluateNoPromise(l2, e4);
                if (n3) {
                  c2("show", r4, s2);
                } else {
                  c2("hide", r4);
                }
                e4.result = null;
              } else {
                c2("show", r4, s2);
              }
            });
            return t3.findNext(this, e4);
          } };
        }
      });
      e2.addCommand("take", function(e3, t3, r2) {
        if (r2.matchToken("take")) {
          let u2 = null;
          let l2 = [];
          while (u2 = e3.parseElement("classRef", r2)) {
            l2.push(u2);
          }
          var n3 = null;
          var i3 = null;
          let c2 = l2.length > 0;
          if (!c2) {
            n3 = e3.parseElement("attributeRef", r2);
            if (n3 == null) {
              e3.raiseParseError(r2, "Expected either a class reference or attribute expression");
            }
            if (r2.matchToken("with")) {
              i3 = e3.requireElement("expression", r2);
            }
          }
          if (r2.matchToken("from")) {
            var a3 = e3.requireElement("expression", r2);
          }
          if (r2.matchToken("for")) {
            var o3 = e3.requireElement("expression", r2);
          } else {
            var o3 = e3.requireElement("implicitMeTarget", r2);
          }
          if (c2) {
            var s2 = { classRefs: l2, from: a3, forElt: o3, args: [l2, a3, o3], op: function(e4, r3, n4, i4) {
              t3.nullCheck(i4, o3);
              t3.implicitLoop(r3, function(e5) {
                var r4 = e5.className;
                if (n4) {
                  t3.implicitLoop(n4, function(e6) {
                    e6.classList.remove(r4);
                  });
                } else {
                  t3.implicitLoop(e5, function(e6) {
                    e6.classList.remove(r4);
                  });
                }
                t3.implicitLoop(i4, function(e6) {
                  e6.classList.add(r4);
                });
              });
              return t3.findNext(this, e4);
            } };
            return s2;
          } else {
            var s2 = { attributeRef: n3, from: a3, forElt: o3, args: [a3, o3, i3], op: function(e4, r3, i4, s3) {
              t3.nullCheck(r3, a3);
              t3.nullCheck(i4, o3);
              t3.implicitLoop(r3, function(e5) {
                if (!s3) {
                  e5.removeAttribute(n3.name);
                } else {
                  e5.setAttribute(n3.name, s3);
                }
              });
              t3.implicitLoop(i4, function(e5) {
                e5.setAttribute(n3.name, n3.value || "");
              });
              return t3.findNext(this, e4);
            } };
            return s2;
          }
        }
      });
      function a2(t3, r2, n3, i3) {
        if (n3 != null) {
          var a3 = t3.resolveSymbol(n3, r2);
        } else {
          var a3 = r2;
        }
        if (a3 instanceof Element || a3 instanceof HTMLDocument) {
          while (a3.firstChild)
            a3.removeChild(a3.firstChild);
          a3.append(e2.runtime.convertValue(i3, "Fragment"));
          t3.processNode(a3);
        } else {
          if (n3 != null) {
            t3.setSymbol(n3, r2, null, i3);
          } else {
            throw "Don't know how to put a value into " + typeof r2;
          }
        }
      }
      e2.addCommand("put", function(e3, t3, r2) {
        if (r2.matchToken("put")) {
          var n3 = e3.requireElement("expression", r2);
          var i3 = r2.matchAnyToken("into", "before", "after");
          if (i3 == null && r2.matchToken("at")) {
            r2.matchToken("the");
            i3 = r2.matchAnyToken("start", "end");
            r2.requireToken("of");
          }
          if (i3 == null) {
            e3.raiseParseError(r2, "Expected one of 'into', 'before', 'at start of', 'at end of', 'after'");
          }
          var o3 = e3.requireElement("expression", r2);
          var s2 = i3.value;
          var u2 = false;
          var l2 = false;
          var c2 = null;
          var f2 = null;
          if (o3.type === "arrayIndex" && s2 === "into") {
            u2 = true;
            f2 = o3.prop;
            c2 = o3.root;
          } else if (o3.prop && o3.root && s2 === "into") {
            f2 = o3.prop.value;
            c2 = o3.root;
          } else if (o3.type === "symbol" && s2 === "into") {
            l2 = true;
            f2 = o3.name;
          } else if (o3.type === "attributeRef" && s2 === "into") {
            var m2 = true;
            f2 = o3.name;
            c2 = e3.requireElement("implicitMeTarget", r2);
          } else if (o3.type === "styleRef" && s2 === "into") {
            var p2 = true;
            f2 = o3.name;
            c2 = e3.requireElement("implicitMeTarget", r2);
          } else if (o3.attribute && s2 === "into") {
            var m2 = o3.attribute.type === "attributeRef";
            var p2 = o3.attribute.type === "styleRef";
            f2 = o3.attribute.name;
            c2 = o3.root;
          } else {
            c2 = o3;
          }
          var h2 = { target: o3, operation: s2, symbolWrite: l2, value: n3, args: [c2, f2, n3], op: function(e4, r3, n4, i4) {
            if (l2) {
              a2(t3, e4, n4, i4);
            } else {
              t3.nullCheck(r3, c2);
              if (s2 === "into") {
                if (m2) {
                  t3.implicitLoop(r3, function(e5) {
                    e5.setAttribute(n4, i4);
                  });
                } else if (p2) {
                  t3.implicitLoop(r3, function(e5) {
                    e5.style[n4] = i4;
                  });
                } else if (u2) {
                  r3[n4] = i4;
                } else {
                  t3.implicitLoop(r3, function(e5) {
                    a2(t3, e5, n4, i4);
                  });
                }
              } else {
                var o4 = s2 === "before" ? Element.prototype.before : s2 === "after" ? Element.prototype.after : s2 === "start" ? Element.prototype.prepend : s2 === "end" ? Element.prototype.append : Element.prototype.append;
                t3.implicitLoop(r3, function(e5) {
                  o4.call(e5, i4 instanceof Node ? i4 : t3.convertValue(i4, "Fragment"));
                  if (e5.parentElement) {
                    t3.processNode(e5.parentElement);
                  } else {
                    t3.processNode(e5);
                  }
                });
              }
            }
            return t3.findNext(this, e4);
          } };
          return h2;
        }
      });
      function o2(e3, t3, r2) {
        var n3;
        if (r2.matchToken("the") || r2.matchToken("element") || r2.matchToken("elements") || r2.currentToken().type === "CLASS_REF" || r2.currentToken().type === "ID_REF" || r2.currentToken().op && r2.currentToken().value === "<") {
          e3.possessivesDisabled = true;
          try {
            n3 = e3.parseElement("expression", r2);
          } finally {
            delete e3.possessivesDisabled;
          }
          if (r2.matchOpToken("'")) {
            r2.requireToken("s");
          }
        } else if (r2.currentToken().type === "IDENTIFIER" && r2.currentToken().value === "its") {
          var i3 = r2.matchToken("its");
          n3 = { type: "pseudopossessiveIts", token: i3, name: i3.value, evaluate: function(e4) {
            return t3.resolveSymbol("it", e4);
          } };
        } else {
          r2.matchToken("my") || r2.matchToken("me");
          n3 = e3.parseElement("implicitMeTarget", r2);
        }
        return n3;
      }
      e2.addCommand("transition", function(e3, t3, n3) {
        if (n3.matchToken("transition")) {
          var i3 = o2(e3, t3, n3);
          var a3 = [];
          var s2 = [];
          var u2 = [];
          var l2 = n3.currentToken();
          while (!e3.commandBoundary(l2) && l2.value !== "over" && l2.value !== "using") {
            if (n3.currentToken().type === "STYLE_REF") {
              let e4 = n3.consumeToken();
              let t4 = e4.value.substr(1);
              a3.push({ type: "styleRefValue", evaluate: function() {
                return t4;
              } });
            } else {
              a3.push(e3.requireElement("stringLike", n3));
            }
            if (n3.matchToken("from")) {
              s2.push(e3.requireElement("expression", n3));
            } else {
              s2.push(null);
            }
            n3.requireToken("to");
            if (n3.matchToken("initial")) {
              u2.push({ type: "initial_literal", evaluate: function() {
                return "initial";
              } });
            } else {
              u2.push(e3.requireElement("expression", n3));
            }
            l2 = n3.currentToken();
          }
          if (n3.matchToken("over")) {
            var c2 = e3.requireElement("expression", n3);
          } else if (n3.matchToken("using")) {
            var f2 = e3.requireElement("expression", n3);
          }
          var m2 = { to: u2, args: [i3, a3, s2, u2, f2, c2], op: function(e4, n4, a4, o3, s3, u3, l3) {
            t3.nullCheck(n4, i3);
            var c3 = [];
            t3.implicitLoop(n4, function(e5) {
              var n5 = new Promise(function(n6, i4) {
                var c4 = e5.style.transition;
                if (l3) {
                  e5.style.transition = "all " + l3 + "ms ease-in";
                } else if (u3) {
                  e5.style.transition = u3;
                } else {
                  e5.style.transition = r.defaultTransition;
                }
                var f3 = t3.getInternalData(e5);
                var m3 = getComputedStyle(e5);
                var p2 = {};
                for (var h2 = 0;h2 < m3.length; h2++) {
                  var v2 = m3[h2];
                  var d2 = m3[v2];
                  p2[v2] = d2;
                }
                if (!f3.initialStyles) {
                  f3.initialStyles = p2;
                }
                for (var h2 = 0;h2 < a4.length; h2++) {
                  var E2 = a4[h2];
                  var T2 = o3[h2];
                  if (T2 === "computed" || T2 == null) {
                    e5.style[E2] = p2[E2];
                  } else {
                    e5.style[E2] = T2;
                  }
                }
                var y2 = false;
                var k2 = false;
                e5.addEventListener("transitionend", function() {
                  if (!k2) {
                    e5.style.transition = c4;
                    k2 = true;
                    n6();
                  }
                }, { once: true });
                e5.addEventListener("transitionstart", function() {
                  y2 = true;
                }, { once: true });
                setTimeout(function() {
                  if (!k2 && !y2) {
                    e5.style.transition = c4;
                    k2 = true;
                    n6();
                  }
                }, 100);
                setTimeout(function() {
                  var t4 = [];
                  for (var r2 = 0;r2 < a4.length; r2++) {
                    var n7 = a4[r2];
                    var i5 = s3[r2];
                    if (i5 === "initial") {
                      var o4 = f3.initialStyles[n7];
                      e5.style[n7] = o4;
                    } else {
                      e5.style[n7] = i5;
                    }
                  }
                }, 0);
              });
              c3.push(n5);
            });
            return Promise.all(c3).then(function() {
              return t3.findNext(m2, e4);
            });
          } };
          return m2;
        }
      });
      e2.addCommand("measure", function(e3, t3, r2) {
        if (!r2.matchToken("measure"))
          return;
        var n3 = o2(e3, t3, r2);
        var i3 = [];
        if (!e3.commandBoundary(r2.currentToken()))
          do {
            i3.push(r2.matchTokenType("IDENTIFIER").value);
          } while (r2.matchOpToken(","));
        return { properties: i3, args: [n3], op: function(e4, r3) {
          t3.nullCheck(r3, n3);
          if (0 in r3)
            r3 = r3[0];
          var a3 = r3.getBoundingClientRect();
          var o3 = { top: r3.scrollTop, left: r3.scrollLeft, topMax: r3.scrollTopMax, leftMax: r3.scrollLeftMax, height: r3.scrollHeight, width: r3.scrollWidth };
          e4.result = { x: a3.x, y: a3.y, left: a3.left, top: a3.top, right: a3.right, bottom: a3.bottom, width: a3.width, height: a3.height, bounds: a3, scrollLeft: o3.left, scrollTop: o3.top, scrollLeftMax: o3.leftMax, scrollTopMax: o3.topMax, scrollWidth: o3.width, scrollHeight: o3.height, scroll: o3 };
          t3.forEach(i3, function(t4) {
            if (t4 in e4.result)
              e4.locals[t4] = e4.result[t4];
            else
              throw "No such measurement as " + t4;
          });
          return t3.findNext(this, e4);
        } };
      });
      e2.addLeafExpression("closestExpr", function(e3, t3, r2) {
        if (r2.matchToken("closest")) {
          if (r2.matchToken("parent")) {
            var n3 = true;
          }
          var i3 = null;
          if (r2.currentToken().type === "ATTRIBUTE_REF") {
            var a3 = e3.requireElement("attributeRefAccess", r2, null);
            i3 = "[" + a3.attribute.name + "]";
          }
          if (i3 == null) {
            var o3 = e3.requireElement("expression", r2);
            if (o3.css == null) {
              e3.raiseParseError(r2, "Expected a CSS expression");
            } else {
              i3 = o3.css;
            }
          }
          if (r2.matchToken("to")) {
            var s2 = e3.parseElement("expression", r2);
          } else {
            var s2 = e3.parseElement("implicitMeTarget", r2);
          }
          var u2 = { type: "closestExpr", parentSearch: n3, expr: o3, css: i3, to: s2, args: [s2], op: function(e4, r3) {
            if (r3 == null) {
              return null;
            } else {
              let e5 = [];
              t3.implicitLoop(r3, function(t4) {
                if (n3) {
                  e5.push(t4.parentElement ? t4.parentElement.closest(i3) : null);
                } else {
                  e5.push(t4.closest(i3));
                }
              });
              if (t3.shouldAutoIterate(r3)) {
                return e5;
              } else {
                return e5[0];
              }
            }
          }, evaluate: function(e4) {
            return t3.unifiedEval(this, e4);
          } };
          if (a3) {
            a3.root = u2;
            a3.args = [u2];
            return a3;
          } else {
            return u2;
          }
        }
      });
      e2.addCommand("go", function(e3, t3, r2) {
        if (r2.matchToken("go")) {
          if (r2.matchToken("back")) {
            var n3 = true;
          } else {
            r2.matchToken("to");
            if (r2.matchToken("url")) {
              var i3 = e3.requireElement("stringLike", r2);
              var a3 = true;
              if (r2.matchToken("in")) {
                r2.requireToken("new");
                r2.requireToken("window");
                var o3 = true;
              }
            } else {
              r2.matchToken("the");
              var s2 = r2.matchAnyToken("top", "middle", "bottom");
              var u2 = r2.matchAnyToken("left", "center", "right");
              if (s2 || u2) {
                r2.requireToken("of");
              }
              var i3 = e3.requireElement("unaryExpression", r2);
              var l2 = r2.matchAnyOpToken("+", "-");
              if (l2) {
                r2.pushFollow("px");
                try {
                  var c2 = e3.requireElement("expression", r2);
                } finally {
                  r2.popFollow();
                }
              }
              r2.matchToken("px");
              var f2 = r2.matchAnyToken("smoothly", "instantly");
              var m2 = { block: "start", inline: "nearest" };
              if (s2) {
                if (s2.value === "top") {
                  m2.block = "start";
                } else if (s2.value === "bottom") {
                  m2.block = "end";
                } else if (s2.value === "middle") {
                  m2.block = "center";
                }
              }
              if (u2) {
                if (u2.value === "left") {
                  m2.inline = "start";
                } else if (u2.value === "center") {
                  m2.inline = "center";
                } else if (u2.value === "right") {
                  m2.inline = "end";
                }
              }
              if (f2) {
                if (f2.value === "smoothly") {
                  m2.behavior = "smooth";
                } else if (f2.value === "instantly") {
                  m2.behavior = "instant";
                }
              }
            }
          }
          var p2 = { target: i3, args: [i3, c2], op: function(e4, r3, i4) {
            if (n3) {
              window.history.back();
            } else if (a3) {
              if (r3) {
                if (o3) {
                  window.open(r3);
                } else {
                  window.location.href = r3;
                }
              }
            } else {
              t3.implicitLoop(r3, function(e5) {
                if (e5 === window) {
                  e5 = document.body;
                }
                if (l2) {
                  let t4 = e5.getBoundingClientRect();
                  let r4 = document.createElement("div");
                  let n4 = l2.value === "+" ? i4 : i4 * -1;
                  let a4 = m2.inline == "start" || m2.inline == "end" ? n4 : 0;
                  let o4 = m2.block == "start" || m2.block == "end" ? n4 : 0;
                  r4.style.position = "absolute";
                  r4.style.top = t4.top + window.scrollY + o4 + "px";
                  r4.style.left = t4.left + window.scrollX + a4 + "px";
                  r4.style.height = t4.height + "px";
                  r4.style.width = t4.width + "px";
                  r4.style.zIndex = "" + Number.MIN_SAFE_INTEGER;
                  r4.style.opacity = "0";
                  document.body.appendChild(r4);
                  setTimeout(function() {
                    document.body.removeChild(r4);
                  }, 100);
                  e5 = r4;
                }
                e5.scrollIntoView(m2);
              });
            }
            return t3.findNext(p2, e4);
          } };
          return p2;
        }
      });
      r.conversions.dynamicResolvers.push(function(t3, r2) {
        if (!(t3 === "Values" || t3.indexOf("Values:") === 0)) {
          return;
        }
        var n3 = t3.split(":")[1];
        var i3 = {};
        var a3 = e2.runtime.implicitLoop.bind(e2.runtime);
        a3(r2, function(e3) {
          var t4 = s2(e3);
          if (t4 !== undefined) {
            i3[t4.name] = t4.value;
            return;
          }
          if (e3.querySelectorAll != null) {
            var r3 = e3.querySelectorAll("input,select,textarea");
            r3.forEach(o3);
          }
        });
        if (n3) {
          if (n3 === "JSON") {
            return JSON.stringify(i3);
          } else if (n3 === "Form") {
            return new URLSearchParams(i3).toString();
          } else {
            throw "Unknown conversion: " + n3;
          }
        } else {
          return i3;
        }
        function o3(e3) {
          var t4 = s2(e3);
          if (t4 == undefined) {
            return;
          }
          if (i3[t4.name] == undefined) {
            i3[t4.name] = t4.value;
            return;
          }
          if (Array.isArray(i3[t4.name]) && Array.isArray(t4.value)) {
            i3[t4.name] = [].concat(i3[t4.name], t4.value);
            return;
          }
        }
        function s2(e3) {
          try {
            var t4 = { name: e3.name, value: e3.value };
            if (t4.name == undefined || t4.value == undefined) {
              return;
            }
            if (e3.type == "radio" && e3.checked == false) {
              return;
            }
            if (e3.type == "checkbox") {
              if (e3.checked == false) {
                t4.value = undefined;
              } else if (typeof t4.value === "string") {
                t4.value = [t4.value];
              }
            }
            if (e3.type == "select-multiple") {
              var r3 = e3.querySelectorAll("option[selected]");
              t4.value = [];
              for (var n4 = 0;n4 < r3.length; n4++) {
                t4.value.push(r3[n4].value);
              }
            }
            return t4;
          } catch (e4) {
            return;
          }
        }
      });
      r.conversions["HTML"] = function(e3) {
        var t3 = function(e4) {
          if (e4 instanceof Array) {
            return e4.map(function(e5) {
              return t3(e5);
            }).join("");
          }
          if (e4 instanceof HTMLElement) {
            return e4.outerHTML;
          }
          if (e4 instanceof NodeList) {
            var r2 = "";
            for (var n3 = 0;n3 < e4.length; n3++) {
              var i3 = e4[n3];
              if (i3 instanceof HTMLElement) {
                r2 += i3.outerHTML;
              }
            }
            return r2;
          }
          if (e4.toString) {
            return e4.toString();
          }
          return "";
        };
        return t3(e3);
      };
      r.conversions["Fragment"] = function(t3) {
        var r2 = document.createDocumentFragment();
        e2.runtime.implicitLoop(t3, function(e3) {
          if (e3 instanceof Node)
            r2.append(e3);
          else {
            var t4 = document.createElement("template");
            t4.innerHTML = e3;
            r2.append(t4.content);
          }
        });
        return r2;
      };
    }
    const k = new o, x = k.lexer, g = k.parser;
    function b(e2, t2) {
      return k.evaluate(e2, t2);
    }
    function w() {
      var t2 = Array.from(e.document.querySelectorAll("script[type='text/hyperscript'][src]"));
      Promise.all(t2.map(function(e2) {
        return fetch(e2.src).then(function(e3) {
          return e3.text();
        });
      })).then((e2) => e2.forEach((e3) => S(e3))).then(() => n2(function() {
        a2();
        k.processNode(document.documentElement);
        document.dispatchEvent(new Event("hyperscript:ready"));
        e.document.addEventListener("htmx:load", function(e2) {
          k.processNode(e2.detail.elt);
        });
      }));
      function n2(e2) {
        if (document.readyState !== "loading") {
          setTimeout(e2);
        } else {
          document.addEventListener("DOMContentLoaded", e2);
        }
      }
      function i2() {
        var e2 = document.querySelector('meta[name="htmx-config"]');
        if (e2) {
          return v(e2.content);
        } else {
          return null;
        }
      }
      function a2() {
        var e2 = i2();
        if (e2) {
          Object.assign(r, e2);
        }
      }
    }
    const S = Object.assign(b, { config: r, use(e2) {
      e2(S);
    }, internals: { lexer: x, parser: g, runtime: k, Lexer: n, Tokens: i, Parser: a, Runtime: o }, ElementCollection: m, addFeature: g.addFeature.bind(g), addCommand: g.addCommand.bind(g), addLeafExpression: g.addLeafExpression.bind(g), addIndirectExpression: g.addIndirectExpression.bind(g), evaluate: k.evaluate.bind(k), parse: k.parse.bind(k), processNode: k.processNode.bind(k), version: "0.9.14", browserInit: w });
    return S;
  });
});

// assets/scripts/hyperscript.ts
var import_hyperscript = __toESM(require__hyperscript_min(), 1);
